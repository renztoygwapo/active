/* Minified: wireframe.js, history.adapter.jquery.js, history.js, mainMenu.base.js, mainMenu.handlers.admin.js, widget.disk_space_admin_popup.js, widgets.FlyoutDialog.js, widgets.QuickView.js, widgets.caret.js */
App.Wireframe.Utils.label=function(caption,for_field,required,after_text){if(typeof(required)=="undefined"){required=false}if(typeof(after_text)=="undefined"){after_text=":"}var label_text=required?App.clean(caption)+after_text+' <span class="label_required">*</span>':App.clean(caption)+after_text;var for_attribute=for_field?'for="'+for_field+'"':"";return"<label "+for_attribute+' class="main_label">'+label_text+"</label>"};App.Wireframe.Utils.button=function(caption,type){if(typeof(type)=="undefined"){type="button"}if(type=="submit"){return'<button type="submit" class="default"><span><span>'+App.clean(caption)+"</span></span></button>"}else{return'<button type="'+type+'"><span><span>'+App.clean(caption)+"</span></span></button>"}};App.Wireframe.BackendLayout=function(){var login_built=false;var backend_built=false;return{init:function(s){var logged_user=typeof(s)=="object"&&s&&typeof(s.logged_user)=="object";if(logged_user){App.Wireframe.BackendLayout.buildBackend(s,s.content_url?s.content_url:null)}else{App.Wireframe.BackendLayout.buildLogin(s)}App.Wireframe.Updates.subscribe("backend_layout",null,function(response){if(typeof(response.refresh_backend_wireframe)=="object"){if(typeof(response.refresh_backend_wireframe["main_menu"])){App.Wireframe.MainMenu.batchSet(response.refresh_backend_wireframe["main_menu"],App.Wireframe.MainMenu.getCurrent())}if(response.refresh_backend_wireframe["status_bar"]){App.Wireframe.Statusbar.batchSet(response.refresh_backend_wireframe["status_bar"])}}});jQuery.ajaxPrefilter(function(options,originalOptions,jqXHR){var success=options.success;options.success=function(data,textStatus,jqXHR){if(typeof(data)=="string"&&(data.indexOf("<!-- *%NOT LOGGED IN%* -->")!=-1||data.indexOf("--Printing login form--")!=-1)){if(App.Wireframe.BackendLayout.isLoginBuilt()){return true}$.ajax({url:App.extendUrl(App.Config.get("logout_url"),{force:1}),type:"POST",data:{submitted:"submitted"},success:function(response){App.Wireframe.BackendLayout.buildLogin(response);App.Wireframe.Flash.error(App.lang("Session expired. Please log in"))},error:function(response){window.location=App.Config.get("homepage_url")}});return false}if(typeof(success)==="function"){return success(data,textStatus,jqXHR)}}});$(document).ajaxError(function(event,response,ajaxSettings,responseText){var event_handler=ajaxSettings.defaultErrorHandler===undefined?"async_operation_error":ajaxSettings.defaultErrorHandler;if(response.status&&event_handler){if(typeof(response)=="object"&&response){if(response.ajax_message){var response_message=response.ajax_message}else{var response_message=App.Wireframe.Utils.responseToErrorMessage(response)}}else{var response_message=App.lang("Unknown error occurred. Please try again later")}App.Wireframe.Events.trigger(event_handler,[response_message,response])}})},buildLogin:function(s){var settings=jQuery.extend({request:null,login_url:"",forgot_password_url:"",reset_password_url:"",login_logo_url:""},s);App.langs=s.clientside_lang;if(backend_built){App.Wireframe.BackendLayout.tearDownBackend()}var body=$("body").addClass("backend_login");if(settings.login_logo_url){body.append('<div id="login_splash"><img src="'+App.clean(settings.login_logo_url)+'" alt="Logo"></div>')}body.append('<div id="content"><div id="auth_dialog_container"><div id="auth_dialog"><h3><span></span></h3></div></div></div>');var auth_dialog_content=body.find("#auth_dialog_container");var auth_dialog=auth_dialog_content.find("#auth_dialog");var auth_dialog_title=auth_dialog_content.find("#auth_dialog h3 span");var login_footer=$('<div id="login_footer"></div>').insertAfter(auth_dialog.parent());var forgot_password_link=$('<a href="'+App.clean(settings.forgot_password_url)+'" class="forgot_password_link">'+App.lang("Forgot password?")+"</a>").appendTo(login_footer).hide();var show_login_form_link=$('<a href="#" class="show_loging_form">'+App.lang("Return to the login screen")+"</a>").appendTo(login_footer).hide();if(!App.Config.get("branding_removed")){login_footer.append("&middot;");login_footer.append('<a href="'+App.Config.get("branding_website")+'" target="_blank" title="'+App.Config.get("branding_description")+'">'+App.Config.get("branding_title")+"</a>")}var show_login_form=function(){App.Wireframe.PageTitle.set(App.lang("Sign In"));auth_dialog_content.attr("class","login_form");auth_dialog_title.html(App.lang("Sign in with your credentials"));forgot_password_link.show();show_login_form_link.hide();login_form.show();forgot_password_form.hide();reset_password_form.hide();return false};var show_forgot_password_form=function(){App.Wireframe.PageTitle.set(App.lang("Recover Password"));auth_dialog_content.attr("class","recover_password_form");auth_dialog_title.html(App.lang("Recover your password"));forgot_password_link.hide();show_login_form_link.show();login_form.hide();forgot_password_form.show();reset_password_form.hide();return false};var show_reset_password_form=function(){App.Wireframe.PageTitle.set(App.lang("Reset Password"));auth_dialog_content.attr("class","reset_password_form");auth_dialog_title.html(App.lang("Enter new password for your account"));forgot_password_link.hide();show_login_form_link.show();login_form.hide();forgot_password_form.hide();reset_password_form.show();return false};var login_form=this.renderLoginForm(settings,auth_dialog_content).appendTo(auth_dialog).hide();var forgot_password_form=this.renderForgotPasswordForm(settings,auth_dialog_content,show_login_form).appendTo(auth_dialog).hide();var reset_password_form=this.resetPasswordForm(settings,auth_dialog_content).appendTo(auth_dialog).hide();forgot_password_link.click(show_forgot_password_form);show_login_form_link.click(show_login_form);var href=window.location.href;if(href.indexOf("reset-password")!=-1&&href.indexOf("user_id")!=-1&&href.indexOf("code")!=-1){show_reset_password_form()}else{show_login_form()}login_built=true},isLoginBuilt:function(){return login_built},renderLoginForm:function(settings,auth_dialog_content){var login_form=$('<form action="'+App.clean(settings.login_url)+'" method="post" novalidate><div class="big_input control_holder"><label class="main_label" for="login_form_email">'+App.lang("Email Address")+' </label><input name="login[email]" id="login_form_email" tabindex="1" class="text_field" type="email" placeholder="'+App.lang("Email Address")+'"></div><div class="big_input control_holder"><label class="main_label" for="login_form_password">'+App.lang("Password")+'</label><input name="login[password]" id="login_form_password" tabindex="2" type="password" class="password_field" placeholder="'+App.lang("Password")+'"></div><div class="control_holder interface_picker_holder"><div class="select_interface"><ul><li><a href="#" title="Default" value="default"><img src="'+App.Wireframe.Utils.imageUrl("icons/interface_default.png","environment","default")+'" alt="'+App.lang("Default")+'" /></a></li><li><a href="#" title="Phone" value="phone"><img src="'+App.Wireframe.Utils.imageUrl("icons/interface_phone.png","environment","default")+'" alt="'+App.lang("Phone")+'" /></a></li></ul><input type="hidden" name="interface" class="selected_value" /></div></div><div class="login_action"><div class="control_holder login_form_remember_holder"><label for="login_form_remember" class="auto"><input id="login_form_remember" tabindex="4" class="auto checkbox_field" type="checkbox" name="login[remember]" value="checked"> <span class="checkbox_field_label">'+App.lang("Remember me")+'</span></label></div><div class="button_holder"><button tabindex="5" class="login" type="submit" accesskey="s">'+App.lang("Sign In")+'</button></div></div><input type="hidden" name="submitted" value="submitted" style="display: none"></form>');var initial_interface="default";var interface_picker_wrapper=login_form.find("div.select_interface");var interface_picker_field=interface_picker_wrapper.find("input.selected_value");var interface_picker_interfaces=interface_picker_wrapper.find("a");interface_picker_interfaces.click(function(){var selected_interface=$(this);interface_picker_interfaces.removeClass("selected");selected_interface.addClass("selected");interface_picker_field.val(selected_interface.attr("value"))});interface_picker_wrapper.find("a[value="+initial_interface+"]").trigger("click");var email_field=login_form.find("input#login_form_email");email_field.change(function(){email_field.val(email_field.val().toLowerCase())});login_form.submit(function(){document.cookie="__ihazacookie=1";var supportsCookies=document.cookie.length>1&&document.cookie.indexOf("__ihazacookie=1")>-1;var thePast=new Date(1976,8,16);document.cookie="__ihazacookie=1;expires="+thePast.toUTCString();if(!supportsCookies){App.Wireframe.Flash.error("Please enable cookies in your browser - the application cannot work properly otherwise");return false}email_field.val(email_field.val().toLowerCase());var email_address=jQuery.trim(email_field.val());if(email_address){if(!App.isValidEmail(email_address)){App.Wireframe.Flash.error("Please enter a valid email address");email_field.focus();return false}}else{App.Wireframe.Flash.error("Please enter your email address");email_field.focus();return false}var password_field=login_form.find("input#login_form_password");var password=password_field.val();if(password==""){App.Wireframe.Flash.error("Please enter your password");password_field.focus();return false}auth_dialog_content.hide();var loader=$('<div id="loader"></div>').insertBefore(auth_dialog_content);$.ajax({url:login_form.attr("action"),type:"post",defaultErrorHandler:false,data:{"login[interface]":login_form.find("div.select_interface input.selected_value").val(),"login[redirect_to_url]":window.location.href,"login[email]":email_address,"login[password]":password,"login[remember]":login_form.find("input#login_form_remember")[0].checked?1:0,submitted:"submitted"},success:function(response){if((typeof(response)!="object")||(response["interface"]=="undefined")){App.Wireframe.Flash.error(response);loader.remove();auth_dialog_content.show();email_field.focus()}else{if(response["interface"]=="default"){App.Wireframe.BackendLayout.buildBackend(response,response.redirect_to_url)}else{window.location=response.redirect_to_url}}},error:function(response){if(typeof(response)=="object"){var reason=App.Wireframe.Utils.responseToErrorMessage(response)}else{var reason=App.lang("Unknown error. Please contact support for assistance")}App.Wireframe.Flash.error(App.lang("Authentication Failed. Reason: :reason",{reason:reason}));loader.remove();auth_dialog_content.show();email_field.focus()}});return false});return login_form},renderForgotPasswordForm:function(settings,auth_dialog_content,success_function){var forgot_password_form=$('<form action="'+App.clean(settings.forgot_password_url)+'" method="post" novalidate><div class="big_input control_holder"><label class="main_label" for="recover_form_email">'+App.lang("Email Address")+' </label><input name="forgot_password[email]" id="recover_form_email" tabindex="1" class="text_field" type="email" placeholder="'+App.lang("Email Address")+'"></div><div class="button_holder"><button tabindex="5" class="login" type="submit" accesskey="s">'+App.lang("Recover Password")+'</button></div><input type="hidden" name="submitted" value="submitted" style="display: none"></form>');var email_field=forgot_password_form.find("input#recover_form_email");email_field.change(function(){email_field.val(email_field.val().toLowerCase())});forgot_password_form.submit(function(){email_field.val(email_field.val().toLowerCase());var email_address=jQuery.trim(email_field.val());if(email_address){if(!App.isValidEmail(email_address)){App.Wireframe.Flash.error("Please enter a valid email address");email_field.focus();return false}}else{App.Wireframe.Flash.error("Please enter your email address");email_field.focus();return false}auth_dialog_content.hide();var loader=$('<div id="loader"></div>').insertBefore(auth_dialog_content);$.ajax({url:forgot_password_form.attr("action"),type:"post",data:{"forgot_password[email]":email_address,submitted:"submitted"},success:function(response){App.Wireframe.Flash.success("Email with instructions on how to reset your password has been sent to email address you have specified");loader.remove();auth_dialog_content.show();if(success_function&&typeof(success_function)=="function"){success_function()}},error:function(response){App.Wireframe.Flash.error("Failed to recover password. Check if your email address is valid, and try again");loader.remove();auth_dialog_content.show();email_field.focus()}});return false});return forgot_password_form},resetPasswordForm:function(settings,auth_dialog_content){var reset_password_form=$('<form action="'+window.location.href+'" method="post" novalidate><div class="big_input control_holder"><label class="main_label" for="reset_form_password">'+App.lang("New Password")+'</label><input name="reset[password]" id="reset_form_password" tabindex="1" type="password" class="password_field" placeholder="'+App.lang("New Password")+'"></div><div class="big_input control_holder"><label class="main_label" for="reset_form_password_a">'+App.lang("Repeat New Password")+'</label><input name="reset[password_a]" id="reset_form_password_a" tabindex="1" type="password" class="password_field" placeholder="'+App.lang("Repeat New Password")+'"></div><div class="button_holder"><button tabindex="5" class="default" type="login" accesskey="s">'+App.lang("Set New Password")+'</button></div><input type="hidden" name="submitted" value="submitted" style="display: none"></form>');reset_password_form.submit(function(){var password_field=reset_password_form.find("#reset_form_password");var password_repeat_field=reset_password_form.find("#reset_form_password_a");var new_password=$.trim(password_field.val());var new_password_repeat=$.trim(password_repeat_field.val());if(!new_password||new_password.length<3){App.Wireframe.Flash.error("Minimum password length is 3 characters");password_field.focus();return false}if(new_password_repeat!=new_password){App.Wireframe.Flash.error("Passwords do not match");password_repeat_field.focus();return false}auth_dialog_content.hide();var loader=$('<div id="loader"></div>').insertBefore(auth_dialog_content);var reset_password_url=reset_password_form.attr("action");if(History&&$.browser.msie){reset_password_url=reset_password_url.replace("#?","?")}$.ajax({url:reset_password_url,type:"post",data:{"reset[password]":new_password,"reset[password_a]":new_password_repeat,submitted:"submitted"},success:function(response){App.Wireframe.Flash.success("Password has been reset successfully");loader.remove();auth_dialog_content.show();App.Wireframe.BackendLayout.buildBackend(response,App.Config.get("homepage_url"));History.pushState({skip:true},null,App.Config.get("homepage_url"))},error:function(response){App.Wireframe.Flash.error("Failed to reset password. Please try again");loader.remove();auth_dialog_content.show();email_field.focus()}});return false});return reset_password_form},tearDownLogin:function(){$("body").empty().removeClass("backend_login");login_built=false},buildBackend:function(s,content_url){var settings=jQuery.extend({request:null,logged_user:null,menu_items:null,breadcrumbs:null,page_tabs:{},statusbar_items:null,search_url:"",quick_search_url:""},s);if(login_built){App.Wireframe.BackendLayout.tearDownLogin()}var body=$("body").addClass("backend");var system_messages_bar=$('<div id="wireframe_system_messages_bar"></div>').appendTo(body);if(settings.system_bar_message){system_messages_bar.append("<p>"+settings.system_bar_message+"</p>");body.attr("system_message","true")}App.langs=s.clientside_lang;body.append('<div id="wireframe_menu" popups_position="right" popups_offset="-18,0"><div id="menu"></div><div id="wireframe_footer"><div id="footer"><p id="powered_by"><a href="http://www.activecollab.com/" target="_blank"><img src="'+App.Wireframe.Utils.imageUrl("layout/branding/acpowered-white.png","system","default")+'" alt="Powered by activeCollab" /></a></p></div></div></div>');App.Wireframe.MainMenu.init("menu",{refresh_url:s.menu_refresh_url});if(typeof(settings.menu_items)=="object"&&settings.menu_items){App.Wireframe.MainMenu.batchSet(settings.menu_items)}if(settings.menu_items_current){App.Wireframe.MainMenu.setCurrent(settings.menu_items_current)}body.append('<div id="wireframe_breadcrumbs"><ul id="breadcrumbs"></ul></div>');App.Wireframe.BreadCrumbs.init("breadcrumbs");if(typeof(settings.breadcrumbs)=="object"&&settings.breadcrumbs){App.Wireframe.BreadCrumbs.batchSet(settings.breadcrumbs)}body.append('<div id="wireframe_page_tabs"><ul id="page_tabs"></ul><ul id="page_tabs_right">'+(settings.whats_new_url?'<li id="global_whats_new"><a href="'+settings.whats_new_url+'">'+App.lang("New Features")+"</a></li>":"")+(settings.help_url?'<li id="global_help" popups_position="bottom" style="position: relative"><a href="'+settings.help_url+'">?</a></li>':"")+'<li id="global_search"></li></ul></div>');if(App.isset(settings.help_url)&&settings.help_url&&App.isset(settings.help_popup_url)&&settings.help_popup_url){$("#global_help").contextPopup({title:App.lang("Help"),data:settings.help_popup_url})}App.Wireframe.PageTabs.init("page_tabs");if(typeof(settings.page_tabs)=="object"&&settings.page_tabs){App.Wireframe.PageTabs.batchSet(settings.page_tabs,settings.page_tabs_current)}$("#global_search").backendQuickSearch({search_url:settings.search_url,quick_search_url:settings.quick_search_url});body.append('<div id="wireframe_main_container"><div id="wireframe_page_title"><ul id="page_title_actions" style="display: none"></ul><h1 id="page_title"></h1></div><div id="wireframe_content"></div></div>');App.Wireframe.PageTitle.init("wireframe_page_title");App.Wireframe.PageTitle.set(App.lang("Loading..."));if(settings.page_title){App.Wireframe.PageTitle.set(settings.page_title)}if(settings.page_title_actions){App.Wireframe.PageTitle.batchSetActions(settings.page_title_actions)}if(settings.print_url){App.Wireframe.PageTitle.setPrintUrl(settings.print_url)}if(settings.benchmark){App.Wireframe.Benchmark.set(settings.benchmark)}if(settings.list_mode_enabled){App.Wireframe.Content.enableListMode()}else{App.Wireframe.Content.disableListMode()}App.Wireframe.Content.init("wireframe_main_container","wireframe_content");body.append('<div id="wireframe_statusbar" popups_position="top" popups_offset="0,10"><div id="bottom_bar"></div></div>');App.Wireframe.Statusbar.init("bottom_bar");if(typeof(settings.statusbar_items)=="object"&&settings.statusbar_items){App.Wireframe.Statusbar.batchSet(settings.statusbar_items)}body.append('<div id="page_loading_indicator">'+App.lang("Loading")+"...</div>");if(content_url&&content_url.indexOf("#")!=-1){var new_route=content_url.substring(content_url.indexOf("#")+1);if(new_route[0]=="?"||new_route[0]=="/"){new_route=new_route.substring(1)}if(App.Config.get("path_info_through_query_string")){if(new_route.indexOf("?")!=-1){new_route=new_route.replace("?","")}content_url=App.Config.get("url_base")+"?"+new_route}else{content_url=App.Config.get("url_base")+"/"+new_route}}if(content_url&&content_url==App.Config.get("homepage_url")){content_url=App.Config.get("homepage_url");if(content_url[(content_url.length-1)]!="/"){content_url+="/"}}if(content_url){App.Wireframe.Content.setFromUrl(content_url,true)}backend_built=true},tearDownBackend:function(){$("body").empty().removeClass("backend");backend_built=false},logout:function(logout_url){if(confirm(App.lang("Are you sure that you want to log out?"))){History.pushState({skip:true},null,App.Config.get("homepage_url"));$.ajax({url:logout_url,type:"post",data:{submitted:"submitted"},success:function(response){if(response.on_logout_url){$("body").block();App.Wireframe.Flash.success("Logout successful. Redirecting, please wait.");window.location=response.on_logout_url;return false}else{App.Wireframe.BackendLayout.buildLogin(response)}},error:function(response){App.Wireframe.Flash.error("Failed to log you in. Check your credentials and try again")}});return true}return false}}}();App.Wireframe.Content=function(){var main_container;var content_wrapper;var loading=[];var current_url=false;var refresh_timer;var refresh_timer_interval;var refresh_timer_callback;var load_from_url=function(url,success,error){App.Wireframe.LoadingIndicator.show();window.soft_refreshed=false;var old_title=App.Wireframe.PageTitle.getUndecorated();$.ajax({url:url,decorate_url:{inline:1},type:"get",success:function(response,status,xhr){var content_type=xhr.getResponseHeader("content-type")||"";if(typeof(content_type)=="string"&&content_type.substr(0,9).toLowerCase()!="text/html"){window.open(url);App.Wireframe.PageTitle.set(old_title)}else{App.Wireframe.Content.set(response,url)}App.Wireframe.LoadingIndicator.hide();if(pending_download){setTimeout(function(){window.location.href=pending_download;pending_download=false},500)}if(typeof(success)=="function"){success.apply(this,[response])}},error:function(response){App.Wireframe.LoadingIndicator.hide();App.Wireframe.Flash.error("Failed to load page. Please try again later");if(typeof(error)=="function"){error.apply(this,[response])}}})};var load_next_page=function(){if(typeof(loading[0])=="string"){load_from_url(loading[0],function(response){loading.splice(0,1);if(loading.length>0){load_next_page()}},function(response){loading.splice(0,1);if(loading.length>0){load_next_page()}})}};var pending_download=false;return{init:function(main_container_id,wrapper_id){main_container=$("#"+main_container_id);content_wrapper=$("#"+wrapper_id);$(window).unbind("statechange.backend_layout").bind("statechange.backend_layout",function(e){if(History.getState().data.skip){return null}current_url=History.getState()["url"];History.handled=false;App.Wireframe.Events.trigger("history_state_changed");if(History.handled){return true}loading.push(History.getState()["url"]);load_next_page()});if(!App.isInDevelopment()){$(window).bind("keydown",function(event){if(event.shiftKey||event.altKey){return true}var refresh=false;if(event.keyCode==116){if(!event.metaKey&&!event.ctrlKey){refresh=true}}else{if($.platform.mac){if(event.metaKey&&event.keyCode==82&&!event.ctrlKey){refresh=true}}else{if(!event.metaKey&&event.keyCode==82&&event.ctrlKey){refresh=true}}}if(!refresh){return true}if(window.soft_refreshed){return true}window.soft_refreshed=true;App.widgets.FlyoutDialog.front().close();var objects_list=$(".objects_list_wrapper:first");if(!objects_list.length||(objects_list.length&&objects_list.objectsList&&!objects_list.objectsList("reload_current"))){App.Wireframe.Content.reload()}return false})}},set:function(content,url){refresh_timer_callback=null,refresh_timer_interval=null;if(refresh_timer){clearInterval(refresh_timer)}App.Wireframe.Content.unbind();App.Wireframe.Events.unbind(".single");App.Wireframe.Events.unbind(".inline_tab");if(typeof(content_wrapper)!="undefined"){content_wrapper.empty().removeClass("no_overflow").append(content);current_url=url;App.Wireframe.Events.trigger("content_updated",[content_wrapper[0],url])}},reload:function(){if(current_url){load_from_url(current_url);window.soft_refreshed=true}},setFromUrl:function(url,force){if(typeof(url)=="string"&&url){App.widgets.FlyoutDialog.front().close();if(url.toLowerCase().indexOf("disposition=attachment")!=-1){pending_download=url;url=App.Config.get("url_base")}if(force){load_from_url(url)}else{if(App.Wireframe.Content.isCurrentUrl(url)){App.Wireframe.Content.reload()}else{var skip_loading=false;if(loading&&typeof(loading)=="object"&&loading.length){if(loading[loading.length-1]==url){skip_loading=true}}if(!skip_loading){if(!App.canNavigateAway()){return false}var page_prefix=App.Config.get("identity_name")?App.Config.get("identity_name")+" — ":false;var loading_title=page_prefix+App.lang("Loading...");History.pushState({handler:"content"},loading_title,url)}}}}},setTimer:function(callback,interval){if(typeof(interval)=="undefined"){interval=180000}refresh_timer_callback=callback;refresh_timer_interval=interval;refresh_timer=window.setInterval(callback,interval);App.Wireframe.Events.bind("document_show.content",function(){if(refresh_timer){clearInterval(refresh_timer)}refresh_timer=window.setInterval(callback,interval)});App.Wireframe.Events.bind("document_hide.content",function(){clearInterval(refresh_timer)})},enableListMode:function(){if(!$("body").is("body.list_mode")){$("body").addClass("list_mode")}},disableListMode:function(){if($("body").is("body.list_mode")){$("body").removeClass("list_mode")}},bind:function(event,callback){App.Wireframe.Events.bind(event+".content",callback)},unbind:function(event){if(event==undefined){event=""}App.Wireframe.Events.unbind(event+".content")},trigger:function(event,params){if(event==undefined){event=""}App.Wireframe.Events.trigger(event+".content",params)},isCurrentUrl:function(url){if(typeof(url)=="string"&&typeof(current_url)=="string"){return unescape(url)==unescape(current_url)}else{return false}}}}();App.Wireframe.Statusbar=function(){var statusbar_wrapper;var statusbar_left;var statusbar_right;return{init:function(wrapper_id){statusbar_wrapper=$("#"+wrapper_id);statusbar_left=$('<div id="statusbar_left_options" class="bottom_options"></div>').appendTo(statusbar_wrapper);statusbar_right=$('<div id="statusbar_right_options" class="bottom_options"></div>').appendTo(statusbar_wrapper)},add:function(item_name,item){var item=jQuery.extend({title:null,url:"",icon:null,badge:null,onclick:null,group:"left",target:null,hotkey:null},item);var badge_value=typeof(item.badge)=="number"&&item.badge>0?item.badge:"";var title=App.clean(item.title);var list_item=$('<li class="icon_button first_level_item_container" id="statusbar_item_'+item_name+'"><a href="'+App.clean(item.url)+'" style="background-image: url(\''+App.clean(item.icon)+'\')" class="first_level_item with_caption" '+(item.target?'target="'+item.target+'"':null)+'><span class="label">'+title+'</span><span class="badge">'+badge_value+"</span></a></li>");if(!badge_value){list_item.find("span.badge").hide()}if(item.group=="right"){statusbar_right.append(list_item)}else{statusbar_left.append(list_item)}var custom_onclick=false;if(typeof(item.onclick)=="string"&&item.onclick){var onclick;eval("onclick ="+item.onclick);if(typeof(onclick)=="function"){onclick.apply(list_item[0]);custom_onclick=true}}if(!custom_onclick&&!item.target){list_item.contextPopup({title:item.title,data:item.url,dataType:"url",triggerEvent:"click"})}},setItemBadge:function(name,value){if(!statusbar_wrapper||!statusbar_wrapper.length){return false}var badge=statusbar_wrapper.find("#"+name+" span.badge");if(badge.length){badge.text(value);if(value){badge.show()}else{badge.hide()}}},batchSet:function(items){App.Wireframe.Statusbar.clear();for(var item_name in items){App.Wireframe.Statusbar.add(item_name,items[item_name])}},clear:function(){App.Wireframe.Events.unbind(".statusbar");statusbar_left.empty();statusbar_right.empty()}}}();App.Wireframe.PageTabs=function(){var page_tabs_wrapper;return{init:function(wrapper_id){page_tabs_wrapper=$("#"+wrapper_id)},addTab:function(name,text,url,is_current){var page_tab=$('<li id="page_tab_'+name+'" class="page_tab"><a href="'+App.clean(url)+'">'+App.clean(text)+"</a></li>");if(is_current){page_tab.find("a").addClass("current")}page_tabs_wrapper.append(page_tab)},addIcon:function(name,text,url,icon){page_tabs_wrapper.append('<li id="page_tab_'+name+'" class="page_tab page_tab_icon"><a href="'+App.clean(url)+'"><img src="'+App.clean(icon)+'"> <span>'+App.clean(text)+"</span></a></li>")},addSeparator:function(){page_tabs_wrapper.append('<li class="separator"></li>')},setAsCurrent:function(tab_name){$("body").attr("current_tab",tab_name);var tab=page_tabs_wrapper.find("#page_tab_"+tab_name);if(tab.length>0){page_tabs_wrapper.find("li.page_tab a").removeClass("current");tab.find("a").addClass("current")}},batchSet:function(tabs,current_tab_name){var tabs_wrapper=$("#page_tabs");App.Wireframe.PageTabs.clear();$.each(tabs,function(tab_name,tab){if(tab.text=="-"){App.Wireframe.PageTabs.addSeparator()}else{if(tab_name.substr(0,5)=="icon-"&&typeof(tab.icon)=="string"&&tab.icon){App.Wireframe.PageTabs.addIcon(tab_name,tab.text,tab.url,tab.icon)}else{App.Wireframe.PageTabs.addTab(tab_name,tab.text,tab.url,tab_name==current_tab_name)}}});page_tabs_wrapper.find("li.page_tab:first").addClass("first")},clear:function(){page_tabs_wrapper.empty()}}}();App.Wireframe.BreadCrumbs=function(){var breadcrumbs_wrapper;return{init:function(wrapper_id){breadcrumbs_wrapper=$("#"+wrapper_id)},add:function(text,url){if(url){breadcrumbs_wrapper.append('<li><a href="'+App.clean(url)+'" title="'+App.clean(text)+'">'+App.clean(text)+'</a><span class="raquo">&raquo;</span></li>')}else{breadcrumbs_wrapper.append('<li class="last"><span class="current">'+App.clean(text)+"</span></li>")}},batchSet:function(breadcrumbs){App.Wireframe.BreadCrumbs.clear();for(var i in breadcrumbs){App.Wireframe.BreadCrumbs.add(breadcrumbs[i]["text"],typeof(breadcrumbs[i]["url"])=="undefined"?"":breadcrumbs[i]["url"])}},clear:function(){breadcrumbs_wrapper.empty()}}}();App.Wireframe.PageTitle=function(){var page_title_wrapper;var page_title;var page_actions;var browser_title;var show_dropdown_timer;var undecorated_value;return{init:function(wrapper_id){page_title_wrapper=$("#"+wrapper_id);page_title=page_title_wrapper.find("h1");page_actions=page_title_wrapper.find("ul")},get:function(){return page_title.text()},getUndecorated:function(){return undecorated_value},set:function(value){var page_sufix=App.Config.get("identity_name")?" — "+App.Config.get("identity_name"):false;if($.browser.msie){document.title=page_sufix?value+page_sufix:value}else{$("html head title:last").text(page_sufix?value+page_sufix:value)}if(page_title&&page_title.length){page_title.text(value)}undecorated_value=value},addWidgetBefore:function(widget_id,widget){this.removeWidget(widget_id);var widgets_wrapper=page_title.find("span.page_title_left_widgets");if(!widgets_wrapper.length){widgets_wrapper=$('<span class="page_title_left_widgets"></span>').prependTo(page_title)}var full_id="page_title_widget_"+widget_id;var widget_wrapper=$('<span id="'+full_id+'" class="left_title_widget widget"></span>').append(widget).prependTo(widgets_wrapper)},addWidgetAfter:function(widget_id,widget){this.removeWidget(widget_id);var widgets_wrapper=page_title.find("span.page_title_right_widgets");if(!widgets_wrapper.length){widgets_wrapper=$('<span class="page_title_right_widgets"></span>').appendTo(page_title)}var full_id="page_title_widget_"+widget_id;var widget_wrapper=$('<span id="'+full_id+'" class="left_title_widget widget"></span>').append(widget).appendTo(widgets_wrapper)},removeWidget:function(widget_id){var full_id="page_title_widget_"+widget_id;page_title.find("#"+full_id)},setClean:function(value){App.Wireframe.PageTitle.clearActions();App.Wireframe.PageTitle.set(value)},snapshot:function(snap){if(typeof(snap)=="undefined"){var page_title_clone=page_title.clone();page_title_clone.find("span.page_title_right_widgets").remove();page_title_clone.find("span.page_title_left_widgets").remove();page_title_clone.find("ul.page_title_actions").remove();return{left_widgets:page_title.find("span.page_title_left_widgets").clone(true,true),right_widgets:page_title.find("span.page_title_right_widgets").clone(true,true),actions:page_actions.clone(true,true),title:page_title_clone.text()}}else{App.Wireframe.PageTitle.set(snap.title);App.Wireframe.PageTitle.clearActions();var old_page_actions=page_actions;page_actions=snap.actions.clone(true,true).insertAfter(page_actions);old_page_actions.remove();if(snap.left_widgets&&snap.left_widgets.length){page_title.prepend(snap.left_widgets)}if(snap.right_widgets&&snap.right_widgets.length){page_title.append(snap.right_widgets)}}},addAction:function(name,action,class_name){var item=$('<li class="title_action" id="page_action_'+name+'"><a href="'+action.url+'" class="title_action_button" title="'+App.clean(action.text)+'">'+App.clean(action.text)+"</a></li>").disableSelection().appendTo(page_actions);var link=item.find("a");if(class_name){link.addClass(class_name)}if(action.icon){link.css({"background-image":"url("+action.icon+")","padding-left":"24px"})}if(typeof(action.attributes)=="object"&&action.attributes){link.attr(action.attributes)}if(typeof(action.onclick)=="string"&&action.onclick){var onclick;eval("onclick = "+action.onclick);if(typeof(onclick)=="function"){onclick.apply(link[0])}}else{if(typeof(action.onclick)=="function"){item.click(function(event){return action.onclick.apply(link[0],[event])})}else{link.openInline()}}page_actions.show()},addDropDown:function(name,text,subitems,class_name){if(typeof(class_name)=="undefined"){class_name=""}var dropdown=$('<li class="title_action object_actions drop_down" id="page_action_'+name+'"><span class="title_action_button '+class_name+'">'+App.clean(text)+'</span><div class="title_actions_dropdown menu_dropdown"><ul class="object_options"></ul></div></li>').appendTo(page_actions).disableSelection();dropdown.hover(function(){show_dropdown_timer=window.setTimeout('App.Wireframe.PageTitle.showDropDown("'+name+'")',100)},function(){App.Wireframe.PageTitle.hideDropDown(name);clearTimeout(show_dropdown_timer)});var options_list=dropdown.find("ul");this.renderDropdownSubitems(subitems,options_list);dropdown.find("div.drop_down *").click(function(){dropdown.removeClass("opened")});page_actions.show()},renderDropdownSubitems:function(subitems,options_list){for(var i in subitems){if(subitems[i]["text"]&&subitems[i]["url"]){var item=$('<li id="page_action_'+i+'" class="subaction"><a href="'+App.clean(subitems[i].url)+'" title="'+App.clean(subitems[i]["text"])+'">'+App.clean(subitems[i]["text"])+"</a></li>").appendTo(options_list);var link=item.find("a");if(subitems[i]["class"]){link.addClass(subitems[i]["class"])}if(subitems[i]["icon"]){link.css({"background-image":"url("+subitems[i]["icon"]+")"})}for(var j in subitems[i]){if(j=="url"||j=="text"||j=="class"||j=="onclick"){continue}link.attr(j,subitems[i][j])}if(typeof(subitems[i]["attributes"])=="object"&&subitems[i]["attributes"]){link.attr(subitems[i]["attributes"])}if(typeof(subitems[i]["onclick"])=="string"&&subitems[i]["onclick"]){var onclick;eval("onclick = "+subitems[i]["onclick"]);if(typeof(onclick)=="function"){onclick.apply(link[0])}}else{if(typeof(subitems[i]["onclick"])=="function"){link.click(function(){return subitems[i]["onclick"].apply(link[0])})}else{link.openInline()}}}else{$('<li id="page_action_'+i+'" class="separator"></li>').appendTo(options_list)}}},updateDropDown:function(dropdown_id,subitems){var dropdown=dropdown_id;if(typeof(dropdown)=="string"){dropdown=$("#"+dropdown_id)}var options_list=dropdown.find("ul").empty();this.renderDropdownSubitems(subitems,options_list)},addActionToDropdown:function(name,action,class_name,dropdown_id,dropdown_title){var dropdown_target=page_actions.find("li#page_action_"+dropdown_id+" div.menu_dropdown ul");if(dropdown_target.length){var dropdown=dropdown_target.parents("li.drop_down:first").show()}else{var dropdown=$('<li class="title_action object_actions drop_down" id="page_action_'+dropdown_id+'"><span class="title_action_button '+dropdown_id+'">'+App.clean(dropdown_title)+'</span><div class="title_actions_dropdown menu_dropdown"><ul class="object_options"</ul></div></li>').appendTo(page_actions).disableSelection();dropdown.click(function(){dropdown.toggleClass("opened")}).delayedHover(function(){},function(){dropdown.removeClass("opened")},300);dropdown.find("div.drop_down *").click(function(){dropdown.removeClass("opened")});var dropdown_target=dropdown.find(".menu_dropdown ul:first")}var item=$('<li class="subaction" id="page_action_'+name+'"><a href="'+App.clean(action.url)+'" class="'+class_name+'">'+App.clean(action.text)+"</a></li>").disableSelection().appendTo(dropdown_target);if(typeof(action.onclick)=="function"){item.find("a").click(action.onclick)}page_actions.show()},showDropDown:function(name){$("#page_action_"+name).addClass("opened")},hideDropDown:function(name){$("#page_action_"+name).removeClass("opened")},batchSetActions:function(actions){App.Wireframe.PageTitle.clearActions();for(var action_name in actions){var class_name=typeof(actions[action_name])!="undefined"?actions[action_name]:"";if(typeof(actions[action_name]["subitems"])=="object"&&actions[action_name]["subitems"]!==null){this.addDropDown(action_name,actions[action_name]["text"],actions[action_name]["subitems"],class_name)}else{this.addAction(action_name,actions[action_name],class_name)}}},initAction:function(name,init_func){var to_init=typeof(name)=="string"?[name]:name;for(var i in to_init){var page_action=page_actions.find("#page_action_"+to_init[i]);if(page_action.length){init_func.apply(page_action[0])}}},removeAction:function(name){var page_action=page_actions.find("#page_action_"+name);if(!page_action.length){return false}var parent_dropdown=page_action.parents("li.drop_down:first");page_action.remove();if(parent_dropdown.length&&!parent_dropdown.find("li").length){parent_dropdown.remove()}return true},clearActions:function(){page_actions.empty().hide()},setPrintUrl:function(url){if(url){App.Wireframe.PageTitle.addAction("print",{url:url,text:App.lang("Print"),onclick:function(){App.Wireframe.Print.doPrint($(this).attr("href"));return false}},"page_print")}else{App.Wireframe.PageTitle.removeAction("print")}}}}();App.Wireframe.Print=function(){var is_active=false;return{doPrint:function(url){if(is_active){App.Wireframe.Print.closePrint()}var print_overlay=$('<div class="print_overlay"></div>').appendTo($("body"));var print_iframe=$('<iframe name="print_iframe" class="print_iframe" src="'+url+'"></iframe>').appendTo(print_overlay);var print_dialog=$('<div class="print_dialog"></div>').insertAfter(print_overlay).append(App.lang("<strong>Preparing page for printing.</strong><br />Please wait."));var close_print_dialog=$('<a href="#" class="close_print_dialog">'+App.lang("Close Dialog")+"</a>").appendTo(print_dialog);close_print_dialog.click(function(){App.Wireframe.Print.close();return false})},close:function(){var print_overlay=$("div.print_overlay").remove();var print_dialog=$("div.print_dialog").remove()}}}();App.Wireframe.Benchmark=function(){return{set:function(data){if(typeof(console)=="object"){var elements=[];if(typeof(data)=="object"&&data){if(typeof(data.execution_time)){elements.push("Execution Time: "+data.execution_time+"s")}if(typeof(data.memory_usage)){elements.push("Memory Usage: "+data.memory_usage)}if(typeof(data.queries_count)){elements.push("Queries Count: "+data.queries_count)}if(jQuery.isArray(data.all_queries)){var total_mysql_time=0;App.each(data.all_queries,function(k,v){total_mysql_time+=v[1]});elements.push("Total Query Time: "+App.customNumberFormat(total_mysql_time,5)+"s")}}console.groupCollapsed(elements.join("; "));if(jQuery.isArray(data.all_queries)){App.each(data.all_queries,function(k,v){console.log(v[0]+" ("+App.customNumberFormat(v[1],5)+")")})}console.groupEnd()}}}}();App.Wireframe.Navigation=function(){var initial_params=null;var loaded_content=null;var loaded_url=null;var homepage_url;var url_base;var remove_trailing_slash=function(url){url=url+"";if(url[url.length-1]=="/"){url=url.substring(0,url.length-1)}return url};var resolve_api_supported=function(){var current_hash=App.Wireframe.Navigation.getHash();if(current_hash){App.Wireframe.Navigation.constructBackend(homepage_url+"/"+current_hash)}else{App.Wireframe.Navigation.constructBackend()}};var resolve_api_disabled_common_urls=function(){var current_hash=App.Wireframe.Navigation.getHash();var search_string=App.Wireframe.Navigation.getSearchString();if(current_hash){if(!search_string){App.Wireframe.Navigation.constructBackend(homepage_url+"/"+current_hash)}else{App.Wireframe.Navigation.redirect(homepage_url+"/#"+current_hash)}}else{if(!search_string){App.Wireframe.Navigation.constructBackend()}else{App.Wireframe.Navigation.redirect(homepage_url+"/#"+search_string)}}};var resolve_api_disabled_pretty_urls=function(){var current_hash=App.Wireframe.Navigation.getHash();var search_string=App.Wireframe.Navigation.getSearchString();if(current_hash){if(!search_string){App.Wireframe.Navigation.constructBackend(homepage_url+"/"+current_hash)}else{App.Wireframe.Navigation.redirect(homepage_url+"/#"+current_hash)}}else{if(!search_string){App.Wireframe.Navigation.constructBackend()}else{App.Wireframe.Navigation.redirect(homepage_url+"/#"+search_string)}}};return{init:function(params){initial_params=params.init_params;loaded_content=params.loaded_content;loaded_url=params.loaded_url;homepage_url=remove_trailing_slash(App.Config.get("homepage_url"));url_base=remove_trailing_slash(App.Config.get("url_base"));if(App.Wireframe.Navigation.isHistoryApiSupported()){resolve_api_supported()}else{if(!App.Wireframe.Navigation.usingPrettyUrls()){resolve_api_disabled_common_urls()}else{resolve_api_disabled_pretty_urls()}}App.Wireframe.Navigation.handleLinks()},getHash:function(){var current_hash=window.location.hash?window.location.hash.substring(1):"";if(current_hash.indexOf("?&_suid")!=-1){current_hash=current_hash.substring(0,current_hash.indexOf("?&_suid"))}else{if(current_hash.indexOf("&_suid")!=-1){current_hash=current_hash.substring(0,current_hash.indexOf("&_suid"))}}return current_hash},getSearchString:function(){if(!App.Wireframe.Navigation.usingPrettyUrls()){var search_string=window.location.search}else{var current_request_url=App.Wireframe.Navigation.getCurrentRequestUrl();if(current_request_url.indexOf("#")!=-1){var without_hash=current_request_url.substring(0,current_request_url.indexOf("#"))}else{var without_hash=current_request_url}var search_string=without_hash.substr(homepage_url.length);if(search_string=="/"){search_string=""}}return search_string},getCurrentRequestUrl:function(){return window.location.href},isHistoryApiSupported:function(){return window.history&&Boolean(window.history.pushState)&&typeof(window.history.pushState)=="function"},usingPrettyUrls:function(){return !App.Config.get("path_info_through_query_string")},constructBackend:function(url){App.Wireframe.BackendLayout.init($.extend(initial_params,(url?{content_url:url}:{})));if(!url){App.Wireframe.Content.set(loaded_content,loaded_url)}},redirect:function(url){window.location=url},handleLinks:function(){$("body").delegate("a","click",function(event){var link=$(this),open_inline=true;if(!link.parents("#menu:first").length){App.Wireframe.MainMenu.closePopup()}if((link.attr("target")=="_blank")||(link.attr("target")=="_self")){open_inline=false}if(link.is(".notinline")){open_inline=false}var href=link.attr("href");if(href=="#"){return false}if(href&&href.indexOf("javascript")===0){return false}var url_base=App.Config.get("url_base");if(href&&url_base&&href.substr(0,url_base.length)!=url_base){window.open(href);return false}var events=link.data("events");if(events&&typeof(events)=="object"&&typeof(events.click)=="object"){open_inline=false}if(App.widgets.QuickView.preview(link,(event.shiftKey&&!event.altKey&&!event.ctrlKey&&!event.metaKey))){return false}if(open_inline){if(!event.metaKey&&!event.ctrlKey&&!event.altKey){App.Wireframe.Content.setFromUrl(link.attr("href"));return false}}return true});$("body").on("mouseover","a.quick_view_item, .quick_view_item a",function(){var homepage_url=App.Config.get("homepage_url","");var anchor_url=$(this).attr("href");if(typeof(anchor_url)=="string"&&anchor_url&&anchor_url.slice(0,homepage_url.length)==homepage_url){if(!this.preview_indicator){this.preview_indicator=$('<span class="quick_view_preview_indicator"><span class="quick_view_preview_indicator_inner"><span class="quick_view_preview_indicator_inner_eye"></span></span></span>').appendTo($(this))}this.preview_indicator.show()}else{return false}});$("body").on("mouseout","a.quick_view_item, .quick_view_item a",function(){if(this.preview_indicator){this.preview_indicator.hide()}});$("body").on("click","span.quick_view_preview_indicator",function(event){if(App.widgets.QuickView.preview($(this),true)){return false}})}}}();App.Wireframe.LoadingIndicator=function(){var loading_indicator=false;var get_loading_indicator=function(){if(loading_indicator===false){loading_indicator=$("body").find("#page_loading_indicator:first")}return loading_indicator};return{show:function(caption){if(caption){caption+=" ..."}else{caption=App.lang("Loading")+" ..."}get_loading_indicator().text(caption).stop().animate({top:0},150)},hide:function(){var indicator=get_loading_indicator();indicator.stop().animate({top:-30},500,function(){indicator.text(App.lang("Loading")+" ...")})}}}();jQuery.fn.openInline=function(){return this.click(function(){App.Wireframe.Content.setFromUrl($(this).attr("href"));return false})};var wireframe_updates_url;$(window).load(function(){wireframe_updates_url=App.Config.get("wireframe_updates_url");if(wireframe_updates_url){App.Wireframe.Updates.start(wireframe_updates_url)}});$(document).ready(function(){var hidden,visibilityState,visibilityChange;if(typeof document.hidden!=="undefined"){hidden="hidden",visibilityChange="visibilitychange",visibilityState="visibilityState"}else{if(typeof document.mozHidden!=="undefined"){hidden="mozHidden",visibilityChange="mozvisibilitychange",visibilityState="mozVisibilityState"}else{if(typeof document.msHidden!=="undefined"){hidden="msHidden",visibilityChange="msvisibilitychange",visibilityState="msVisibilityState"}else{if(typeof document.webkitHidden!=="undefined"){hidden="webkitHidden",visibilityChange="webkitvisibilitychange",visibilityState="webkitVisibilityState"}}}}var document_hidden=document[hidden];document.addEventListener(visibilityChange,function(){if(document_hidden!=document[hidden]){if(document[hidden]){App.Wireframe.Events.trigger("document_hide")}else{App.Wireframe.Events.trigger("document_show")}document_hidden=document[hidden]}})});
(function(window,undefined){var History=window.History=window.History||{},jQuery=window.jQuery;if(typeof History.Adapter!=="undefined"){throw new Error("History.js Adapter has already been loaded...")}History.Adapter={bind:function(el,event,callback){jQuery(el).bind(event,callback)},trigger:function(el,event,extra){jQuery(el).trigger(event,extra)},extractEventData:function(key,event,extra){var result=(event&&event.originalEvent&&event.originalEvent[key])||(extra&&extra[key])||undefined;return result},onDomLoad:function(callback){jQuery(callback)}};if(typeof History.init!=="undefined"){History.init()}})(window);
(function(window,undefined){var console=window.console||undefined,document=window.document,navigator=window.navigator,setTimeout=window.setTimeout,clearTimeout=window.clearTimeout,setInterval=window.setInterval,clearInterval=window.clearInterval,JSON=window.JSON,alert=window.alert,History=window.History=window.History||{},sessionStorage,history=window.history;try{sessionStorage=window.sessionStorage;sessionStorage.setItem("TEST","1");sessionStorage.removeItem("TEST")}catch(e){sessionStorage=false}JSON.stringify=JSON.stringify||JSON.encode;JSON.parse=JSON.parse||JSON.decode;if(typeof History.init!=="undefined"){throw new Error("History.js Core has already been loaded...")}History.init=function(){if(typeof History.Adapter==="undefined"){return false}if(typeof History.initCore!=="undefined"){History.initCore()}if(typeof History.initHtml4!=="undefined"){History.initHtml4()}return true};History.initCore=function(){if(typeof History.initCore.initialized!=="undefined"){return false}else{History.initCore.initialized=true}History.options=History.options||{};History.options.hashChangeInterval=History.options.hashChangeInterval||100;History.options.safariPollInterval=History.options.safariPollInterval||500;History.options.doubleCheckInterval=History.options.doubleCheckInterval||500;History.options.storeInterval=History.options.storeInterval||1000;History.options.busyDelay=History.options.busyDelay||250;History.options.debug=History.options.debug||false;History.options.initialTitle=History.options.initialTitle||document.title;History.intervalList=[];History.clearAllIntervals=function(){var i,il=History.intervalList;if(typeof il!=="undefined"&&il!==null){for(i=0;i<il.length;i++){clearInterval(il[i])}History.intervalList=null}};History.debug=function(){if((History.options.debug||false)){History.log.apply(History,arguments)}};History.log=function(){var consoleExists=!(typeof console==="undefined"||typeof console.log==="undefined"||typeof console.log.apply==="undefined"),textarea=document.getElementById("log"),message,i,n,args,arg;if(consoleExists){args=Array.prototype.slice.call(arguments);message=args.shift();if(typeof console.debug!=="undefined"){console.debug.apply(console,[message,args])}else{console.log.apply(console,[message,args])}}else{message=("\n"+arguments[0]+"\n")}for(i=1,n=arguments.length;i<n;++i){arg=arguments[i];if(typeof arg==="object"&&typeof JSON!=="undefined"){try{arg=JSON.stringify(arg)}catch(Exception){}}message+="\n"+arg+"\n"}if(textarea){textarea.value+=message+"\n-----\n";textarea.scrollTop=textarea.scrollHeight-textarea.clientHeight}else{if(!consoleExists){alert(message)}}return true};History.getInternetExplorerMajorVersion=function(){var result=History.getInternetExplorerMajorVersion.cached=(typeof History.getInternetExplorerMajorVersion.cached!=="undefined")?History.getInternetExplorerMajorVersion.cached:(function(){var v=3,div=document.createElement("div"),all=div.getElementsByTagName("i");while((div.innerHTML="<!--[if gt IE "+(++v)+"]><i></i><![endif]-->")&&all[0]){}return(v>4)?v:false})();return result};History.isInternetExplorer=function(){var result=History.isInternetExplorer.cached=(typeof History.isInternetExplorer.cached!=="undefined")?History.isInternetExplorer.cached:Boolean(History.getInternetExplorerMajorVersion());return result};History.emulated={pushState:!Boolean(window.history&&window.history.pushState&&window.history.replaceState&&!((/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i).test(navigator.userAgent)||(/AppleWebKit\/5([0-2]|3[0-2])/i).test(navigator.userAgent))),hashChange:Boolean(!(("onhashchange" in window)||("onhashchange" in document))||(History.isInternetExplorer()&&History.getInternetExplorerMajorVersion()<8))};History.enabled=!History.emulated.pushState;History.bugs={setHash:Boolean(!History.emulated.pushState&&navigator.vendor==="Apple Computer, Inc."&&/AppleWebKit\/5([0-2]|3[0-3])/.test(navigator.userAgent)),safariPoll:Boolean(!History.emulated.pushState&&navigator.vendor==="Apple Computer, Inc."&&/AppleWebKit\/5([0-2]|3[0-3])/.test(navigator.userAgent)),ieDoubleCheck:Boolean(History.isInternetExplorer()&&History.getInternetExplorerMajorVersion()<8),hashEscape:Boolean(History.isInternetExplorer()&&History.getInternetExplorerMajorVersion()<7)};History.isEmptyObject=function(obj){for(var name in obj){return false}return true};History.cloneObject=function(obj){var hash,newObj;if(obj){hash=JSON.stringify(obj);newObj=JSON.parse(hash)}else{newObj={}}return newObj};History.getRootUrl=function(){var rootUrl=document.location.protocol+"//"+(document.location.hostname||document.location.host);if(document.location.port||false){rootUrl+=":"+document.location.port}rootUrl+="/";return rootUrl};History.getBaseHref=function(){var baseElements=document.getElementsByTagName("base"),baseElement=null,baseHref="";if(baseElements.length===1){baseElement=baseElements[0];baseHref=baseElement.href.replace(/[^\/]+$/,"")}baseHref=baseHref.replace(/\/+$/,"");if(baseHref){baseHref+="/"}return baseHref};History.getBaseUrl=function(){var baseUrl=History.getBaseHref()||History.getBasePageUrl()||History.getRootUrl();return baseUrl};History.getPageUrl=function(){var State=History.getState(false,false),stateUrl=(State||{}).url||document.location.href,pageUrl;pageUrl=stateUrl.replace(/\/+$/,"").replace(/[^\/]+$/,function(part,index,string){return(/\./).test(part)?part:part+"/"});return pageUrl};History.getBasePageUrl=function(){var basePageUrl=document.location.href.replace(/[#\?].*/,"").replace(/[^\/]+$/,function(part,index,string){return(/[^\/]$/).test(part)?"":part}).replace(/\/+$/,"")+"/";return basePageUrl};History.getFullUrl=function(url,allowBaseHref){var fullUrl=url,firstChar=url.substring(0,1);allowBaseHref=(typeof allowBaseHref==="undefined")?true:allowBaseHref;if(/[a-z]+\:\/\//.test(url)){}else{if(firstChar==="/"){fullUrl=History.getRootUrl()+url.replace(/^\/+/,"")}else{if(firstChar==="#"){fullUrl=History.getPageUrl().replace(/#.*/,"")+url}else{if(firstChar==="?"){fullUrl=History.getPageUrl().replace(/[\?#].*/,"")+url}else{if(allowBaseHref){fullUrl=History.getBaseUrl()+url.replace(/^(\.\/)+/,"")}else{fullUrl=History.getBasePageUrl()+url.replace(/^(\.\/)+/,"")}}}}}return fullUrl.replace(/\#$/,"")};History.getShortUrl=function(url){var shortUrl=url,baseUrl=History.getBaseUrl(),rootUrl=History.getRootUrl();if(History.emulated.pushState){shortUrl=shortUrl.replace(baseUrl,"")}shortUrl=shortUrl.replace(rootUrl,"/");if(History.isTraditionalAnchor(shortUrl)){shortUrl="./"+shortUrl}shortUrl=shortUrl.replace(/^(\.\/)+/g,"./").replace(/\#$/,"");return shortUrl};History.store={};History.idToState=History.idToState||{};History.stateToId=History.stateToId||{};History.urlToId=History.urlToId||{};History.storedStates=History.storedStates||[];History.savedStates=History.savedStates||[];History.normalizeStore=function(){History.store.idToState=History.store.idToState||{};History.store.urlToId=History.store.urlToId||{};History.store.stateToId=History.store.stateToId||{}};History.getState=function(friendly,create){if(typeof friendly==="undefined"){friendly=true}if(typeof create==="undefined"){create=true}var State=History.getLastSavedState();if(!State&&create){State=History.createStateObject()}if(friendly){State=History.cloneObject(State);State.url=State.cleanUrl||State.url}return State};History.getIdByState=function(newState){var id=History.extractId(newState.url),str;if(!id){str=History.getStateString(newState);if(typeof History.stateToId[str]!=="undefined"){id=History.stateToId[str]}else{if(typeof History.store.stateToId[str]!=="undefined"){id=History.store.stateToId[str]}else{while(true){id=(new Date()).getTime()+String(Math.random()).replace(/\D/g,"");if(typeof History.idToState[id]==="undefined"&&typeof History.store.idToState[id]==="undefined"){break}}History.stateToId[str]=id;History.idToState[id]=newState}}}return id};History.normalizeState=function(oldState){var newState,dataNotEmpty;if(!oldState||(typeof oldState!=="object")){oldState={}}if(typeof oldState.normalized!=="undefined"){return oldState}if(!oldState.data||(typeof oldState.data!=="object")){oldState.data={}}newState={};newState.normalized=true;newState.title=oldState.title||"";newState.url=History.getFullUrl(History.unescapeString(oldState.url||document.location.href));newState.hash=History.getShortUrl(newState.url);newState.data=History.cloneObject(oldState.data);newState.id=History.getIdByState(newState);newState.cleanUrl=newState.url.replace(/\??\&_suid.*/,"");newState.url=newState.cleanUrl;dataNotEmpty=!History.isEmptyObject(newState.data);if(newState.title||dataNotEmpty){newState.hash=History.getShortUrl(newState.url).replace(/\??\&_suid.*/,"");if(!/\?/.test(newState.hash)){newState.hash+="?"}newState.hash+="&_suid="+newState.id}newState.hashedUrl=History.getFullUrl(newState.hash);if((History.emulated.pushState||History.bugs.safariPoll)&&History.hasUrlDuplicate(newState)){newState.url=newState.hashedUrl}return newState};History.createStateObject=function(data,title,url){var State={data:data,title:title,url:url};State=History.normalizeState(State);return State};History.getStateById=function(id){id=String(id);var State=History.idToState[id]||History.store.idToState[id]||undefined;return State};History.getStateString=function(passedState){var State,cleanedState,str;State=History.normalizeState(passedState);cleanedState={data:State.data,title:passedState.title,url:passedState.url};str=JSON.stringify(cleanedState);return str};History.getStateId=function(passedState){var State,id;State=History.normalizeState(passedState);id=State.id;return id};History.getHashByState=function(passedState){var State,hash;State=History.normalizeState(passedState);hash=State.hash;return hash};History.extractId=function(url_or_hash){var id,parts,url;parts=/(.*)\&_suid=([0-9]+)$/.exec(url_or_hash);url=parts?(parts[1]||url_or_hash):url_or_hash;id=parts?String(parts[2]||""):"";return id||false};History.isTraditionalAnchor=function(url_or_hash){var isTraditional=!(/[\/\?\.]/.test(url_or_hash));return isTraditional};History.extractState=function(url_or_hash,create){var State=null,id,url;create=create||false;id=History.extractId(url_or_hash);if(id){State=History.getStateById(id)}if(!State){url=History.getFullUrl(url_or_hash);id=History.getIdByUrl(url)||false;if(id){State=History.getStateById(id)}if(!State&&create&&!History.isTraditionalAnchor(url_or_hash)){State=History.createStateObject(null,null,url)}}return State};History.getIdByUrl=function(url){var id=History.urlToId[url]||History.store.urlToId[url]||undefined;return id};History.getLastSavedState=function(){return History.savedStates[History.savedStates.length-1]||undefined};History.getLastStoredState=function(){return History.storedStates[History.storedStates.length-1]||undefined};History.hasUrlDuplicate=function(newState){var hasDuplicate=false,oldState;oldState=History.extractState(newState.url);hasDuplicate=oldState&&oldState.id!==newState.id;return hasDuplicate};History.storeState=function(newState){History.urlToId[newState.url]=newState.id;History.storedStates.push(History.cloneObject(newState));return newState};History.isLastSavedState=function(newState){var isLast=false,newId,oldState,oldId;if(History.savedStates.length){newId=newState.id;oldState=History.getLastSavedState();oldId=oldState.id;isLast=(newId===oldId)}return isLast};History.saveState=function(newState){if(History.isLastSavedState(newState)){return false}History.savedStates.push(History.cloneObject(newState));return true};History.getStateByIndex=function(index){var State=null;if(typeof index==="undefined"){State=History.savedStates[History.savedStates.length-1]}else{if(index<0){State=History.savedStates[History.savedStates.length+index]}else{State=History.savedStates[index]}}return State};History.getHash=function(){var hash=History.unescapeHash(document.location.hash);return hash};History.unescapeString=function(str){var result=str,tmp;while(true){tmp=window.unescape(result);if(tmp===result){break}result=tmp}return result};History.unescapeHash=function(hash){var result=History.normalizeHash(hash);result=History.unescapeString(result);return result};History.normalizeHash=function(hash){var result=hash.replace(/[^#]*#/,"").replace(/#.*/,"");return result};History.setHash=function(hash,queue){var adjustedHash,State,pageUrl;if(queue!==false&&History.busy()){History.pushQueue({scope:History,callback:History.setHash,args:arguments,queue:queue});return false}adjustedHash=History.escapeHash(hash);History.busy(true);State=History.extractState(hash,true);if(State&&!History.emulated.pushState){History.pushState(State.data,State.title,State.url,false)}else{if(document.location.hash!==adjustedHash){if(History.bugs.setHash){pageUrl=History.getPageUrl();History.pushState(null,null,pageUrl+"#"+adjustedHash,false)}else{document.location.hash=adjustedHash}}}return History};History.escapeHash=function(hash){var result=History.normalizeHash(hash);result=window.escape(result);if(!History.bugs.hashEscape){result=result.replace(/\%21/g,"!").replace(/\%26/g,"&").replace(/\%3D/g,"=").replace(/\%3F/g,"?")}return result};History.getHashByUrl=function(url){var hash=String(url).replace(/([^#]*)#?([^#]*)#?(.*)/,"$2");hash=History.unescapeHash(hash);return hash};History.setTitle=function(newState){var title=newState.title,firstState;if(!title){firstState=History.getStateByIndex(0);if(firstState&&firstState.url===newState.url){title=firstState.title||History.options.initialTitle}}try{document.getElementsByTagName("title")[0].innerHTML=title.replace("<","&lt;").replace(">","&gt;").replace(" & "," &amp; ")}catch(Exception){}document.title=title;return History};History.queues=[];History.busy=function(value){if(typeof value!=="undefined"){History.busy.flag=value}else{if(typeof History.busy.flag==="undefined"){History.busy.flag=false}}if(!History.busy.flag){clearTimeout(History.busy.timeout);var fireNext=function(){var i,queue,item;if(History.busy.flag){return}for(i=History.queues.length-1;i>=0;--i){queue=History.queues[i];if(queue.length===0){continue}item=queue.shift();History.fireQueueItem(item);History.busy.timeout=setTimeout(fireNext,History.options.busyDelay)}};History.busy.timeout=setTimeout(fireNext,History.options.busyDelay)}return History.busy.flag};History.busy.flag=false;History.fireQueueItem=function(item){return item.callback.apply(item.scope||History,item.args||[])};History.pushQueue=function(item){History.queues[item.queue||0]=History.queues[item.queue||0]||[];History.queues[item.queue||0].push(item);return History};History.queue=function(item,queue){if(typeof item==="function"){item={callback:item}}if(typeof queue!=="undefined"){item.queue=queue}if(History.busy()){History.pushQueue(item)}else{History.fireQueueItem(item)}return History};History.clearQueue=function(){History.busy.flag=false;History.queues=[];return History};History.stateChanged=false;History.doubleChecker=false;History.doubleCheckComplete=function(){History.stateChanged=true;History.doubleCheckClear();return History};History.doubleCheckClear=function(){if(History.doubleChecker){clearTimeout(History.doubleChecker);History.doubleChecker=false}return History};History.doubleCheck=function(tryAgain){History.stateChanged=false;History.doubleCheckClear();if(History.bugs.ieDoubleCheck){History.doubleChecker=setTimeout(function(){History.doubleCheckClear();if(!History.stateChanged){tryAgain()}return true},History.options.doubleCheckInterval)}return History};History.safariStatePoll=function(){var urlState=History.extractState(document.location.href),newState;if(!History.isLastSavedState(urlState)){newState=urlState}else{return}if(!newState){newState=History.createStateObject()}History.Adapter.trigger(window,"popstate");return History};History.back=function(queue){if(queue!==false&&History.busy()){History.pushQueue({scope:History,callback:History.back,args:arguments,queue:queue});return false}History.busy(true);History.doubleCheck(function(){History.back(false)});history.go(-1);return true};History.forward=function(queue){if(queue!==false&&History.busy()){History.pushQueue({scope:History,callback:History.forward,args:arguments,queue:queue});return false}History.busy(true);History.doubleCheck(function(){History.forward(false)});history.go(1);return true};History.go=function(index,queue){var i;if(index>0){for(i=1;i<=index;++i){History.forward(queue)}}else{if(index<0){for(i=-1;i>=index;--i){History.back(queue)}}else{throw new Error("History.go: History.go requires a positive or negative integer passed.")}}return History};if(History.emulated.pushState){var emptyFunction=function(){};History.pushState=History.pushState||emptyFunction;History.replaceState=History.replaceState||emptyFunction}else{History.onPopState=function(event,extra){var stateId=false,newState=false,currentHash,currentState;History.doubleCheckComplete();currentHash=History.getHash();if(currentHash){currentState=History.extractState(currentHash||document.location.href,true);if(currentState){History.replaceState(currentState.data,currentState.title,currentState.url,false)}else{History.Adapter.trigger(window,"anchorchange");History.busy(false)}History.expectedStateId=false;return false}stateId=History.Adapter.extractEventData("state",event,extra)||false;if(stateId){newState=History.getStateById(stateId)}else{if(History.expectedStateId){newState=History.getStateById(History.expectedStateId)}else{newState=History.extractState(document.location.href)}}if(!newState){newState=History.createStateObject(null,null,document.location.href)}History.expectedStateId=false;if(History.isLastSavedState(newState)){History.busy(false);return false}History.storeState(newState);History.saveState(newState);History.setTitle(newState);History.Adapter.trigger(window,"statechange");History.busy(false);return true};History.Adapter.bind(window,"popstate",History.onPopState);History.pushState=function(data,title,url,queue){if(History.getHashByUrl(url)&&History.emulated.pushState){throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).")}if(queue!==false&&History.busy()){History.pushQueue({scope:History,callback:History.pushState,args:arguments,queue:queue});return false}History.busy(true);var newState=History.createStateObject(data,title,url);if(History.isLastSavedState(newState)){History.busy(false)}else{History.storeState(newState);History.expectedStateId=newState.id;history.pushState(newState.id,newState.title,newState.url);History.Adapter.trigger(window,"popstate")}return true};History.replaceState=function(data,title,url,queue){if(History.getHashByUrl(url)&&History.emulated.pushState){throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).")}if(queue!==false&&History.busy()){History.pushQueue({scope:History,callback:History.replaceState,args:arguments,queue:queue});return false}History.busy(true);var newState=History.createStateObject(data,title,url);if(History.isLastSavedState(newState)){History.busy(false)}else{History.storeState(newState);History.expectedStateId=newState.id;history.replaceState(newState.id,newState.title,newState.url);History.Adapter.trigger(window,"popstate")}return true}}if(sessionStorage){try{History.store=JSON.parse(sessionStorage.getItem("History.store"))||{}}catch(err){History.store={}}History.normalizeStore()}else{History.store={};History.normalizeStore()}History.Adapter.bind(window,"beforeunload",History.clearAllIntervals);History.Adapter.bind(window,"unload",History.clearAllIntervals);History.saveState(History.storeState(History.extractState(document.location.href,true)));if(sessionStorage){History.onUnload=function(){var currentStore,item;try{currentStore=JSON.parse(sessionStorage.getItem("History.store"))||{}}catch(err){currentStore={}}currentStore.idToState=currentStore.idToState||{};currentStore.urlToId=currentStore.urlToId||{};currentStore.stateToId=currentStore.stateToId||{};for(item in History.idToState){if(!History.idToState.hasOwnProperty(item)){continue}currentStore.idToState[item]=History.idToState[item]}for(item in History.urlToId){if(!History.urlToId.hasOwnProperty(item)){continue}currentStore.urlToId[item]=History.urlToId[item]}for(item in History.stateToId){if(!History.stateToId.hasOwnProperty(item)){continue}currentStore.stateToId[item]=History.stateToId[item]}History.store=currentStore;History.normalizeStore();sessionStorage.setItem("History.store",JSON.stringify(currentStore))};History.intervalList.push(setInterval(History.onUnload,History.options.storeInterval));History.Adapter.bind(window,"beforeunload",History.onUnload);History.Adapter.bind(window,"unload",History.onUnload)}if(!History.emulated.pushState){if(History.bugs.safariPoll){History.intervalList.push(setInterval(History.safariStatePoll,History.options.safariPollInterval))}if(navigator.vendor==="Apple Computer, Inc."||(navigator.appCodeName||"")==="Mozilla"){History.Adapter.bind(window,"hashchange",function(){History.Adapter.trigger(window,"popstate")});if(History.getHash()){History.Adapter.onDomLoad(function(){History.Adapter.trigger(window,"hashchange")})}}}};History.init()})(window);
App.Wireframe.MainMenu=function(){var menu_wrapper;var menu_items={};var menu_settings={};var popups={};var current_context="popup";var current_popup_item={};var handlers={};var handler_inits={};var main_item_close_timeout=null;var main_item_closing_popup=null;var get_current_popup_item=function(context){context=context?context:current_context;return current_popup_item[context]};var set_current_popup_item=function(item,context){context=context?context:current_context;var current_item=get_current_popup_item(context);if(current_item&&current_item.is(":visible")){current_item.removeClass("current")}if(context=="popup"&&current_context=="popup"&&!(current_item&&current_item.get(0)==item.get(0))){submenu_methods.close()}current_popup_item[context]=item.addClass("current")};var keystrokes=function(){var current_item=get_current_popup_item();var current_row=current_item.is(".menu_navigation_row")?current_item:current_item.parents(".menu_navigation_row:first");var current_group=current_item.parents(".menu_navigation_group:first");return{right:function(){if(current_item.is(".open_submenu, .open_submenu_default")){submenu_methods.open(current_item,true,true);return true}var next_item=current_item.nextAll(".menu_navigation_item:visible:first");if(next_item.length){set_current_popup_item(next_item);return true}},left:function(){if(current_context=="submenu"){submenu_methods.close();return true}else{if(current_context=="popup"){var previous_item=current_item.prevAll(".menu_navigation_item:visible:first");if(previous_item.length){set_current_popup_item(previous_item);return true}}}},up:function(){var up_item=current_row.prevAll(".menu_navigation_row.menu_navigation_item:visible:first");if(up_item.length){set_current_popup_item(up_item);return true}var up_item=current_row.prevAll(".menu_navigation_row:visible:first").find(".menu_navigation_item:visible:first");if(up_item.length){set_current_popup_item(up_item);return true}var up_group=current_group;do{up_group=up_group.prevAll(".menu_navigation_group:visible:first");if(up_group.length){up_item=up_group.find(".menu_navigation_item:visible:last");if(up_item.length){set_current_popup_item(up_item);break}}}while(up_group&&up_group.length)},down:function(){var down_item=current_row.nextAll(".menu_navigation_row.menu_navigation_item:visible:first");if(down_item.length){set_current_popup_item(down_item);return true}down_item=current_row.nextAll(".menu_navigation_row:visible:first").find(".menu_navigation_item:visible:first");if(down_item.length){set_current_popup_item(down_item);return true}var down_group=current_group;do{down_group=down_group.nextAll(".menu_navigation_group:visible:first");if(down_group.length){down_item=down_group.find(".menu_navigation_item:visible:first");if(down_item.length){set_current_popup_item(down_item);break}}}while(down_group&&down_group.length)},enter:function(){if(current_item.is(":hidden")){current_item=current_item.parents("#menu_popup_body_wrapper:first").find(".menu_navigation_item:visible:first");if(!current_item.length){return false}}if(current_item.is(".open_submenu_default, .open_submenu")){submenu_methods.open(current_item,true,true);return true}var target=current_item.find(".menu_navigation_target:first");var element=target.length?target:current_item;App.Wireframe.Content.setFromUrl(element.attr("href"));popup_methods.close()},space:function(){if(current_item.is(".open_submenu_default, .open_submenu")){submenu_methods.open(current_item,true,true);return true}var target=current_item.find(".menu_navigation_target:first");var element=target.length?target:current_item;App.Wireframe.Content.setFromUrl(element.attr("href"));popup_methods.close()},escape:function(){if(current_context=="submenu"){submenu_methods.close()}else{if(current_context=="popup"){popup_methods.close()}}},character:function(character){}}};var popup_methods=function(){var current;var focused_item;var previous_x_offset=0;var min_refresh_interval=5;return{open:function(settings,instant){if(popup_methods.current&&popup_methods.current["settings"]["id"]==settings.id){return true}var pending_refresh=false;if(settings.auto_refresh&&(!settings.refreshed_on||($.now()-settings.refreshed_on)>(min_refresh_interval*1000))&&!settings.refreshing){pending_refresh=true;refresh_methods.refresh(settings.id)}var popup_dom=popup_methods.render(settings,pending_refresh);popup_dom.methods={};popup_dom.methods.set_current=set_current_popup_item;focused_item=$("input:focus, select:focus, button:focus, textarea:focus, submit:focus").blur();if(!instant){popup_dom.wrapper.css("opacity",0).stop().animate({opacity:1},150,function(){menu_wrapper.addClass("popup_open");menu_items[settings.id].addClass("hover")})}else{menu_wrapper.addClass("popup_open");menu_items[settings.id].addClass("hover")}},render:function(settings,pending_refresh){popup_methods.close();if(!pending_refresh){menu_wrapper.addClass("popup_open");menu_items[settings.id].addClass("hover")}var popup_dom=popup_methods.current={};popup_dom.settings=settings;popup_dom.wrapper=$('<div id="menu_popup"></div>').appendTo(menu_wrapper);if(!pending_refresh&&(popup_dom.settings["initial_refresh"]&&!popup_dom.settings["loaded"])){pending_refresh=true}if(pending_refresh){popup_dom.wrapper.addClass("refreshing")}popup_dom.background=$('<div id="menu_popup_background"></div>').appendTo(popup_dom.wrapper);if(settings.tabs){popup_dom.tabs=$('<div id="menu_popup_tabs"></div>').appendTo(popup_dom.wrapper);popup_dom.tabs_list=$("<ul></ul>").appendTo(popup_dom.tabs);var current_tab;var previous_top_offset;var row_count=0;$.each(settings.tabs,function(tab_id,tab_details){current_tab=$('<li><a href="'+tab_details.url+'" id="menu_popup_tab_'+tab_id+'">'+tab_details.text+"</a></li>").appendTo(popup_dom.tabs_list);if(current_tab.offset().top!=previous_top_offset){current_tab.addClass("first_in_row");current_tab.prev("li").addClass("last_in_row");row_count++}previous_top_offset=current_tab.offset().top});popup_dom.tabs.on("click","a",function(){popup_methods.close()});if(row_count>1){var row;for(var counter=0;counter<row_count;counter++){row=$('<div class="menu_popup_tabs_row"></div>');row.appendTo(popup_dom.tabs).css({height:current_tab.height()-1,top:counter*current_tab.height()});if(counter==0){row.addClass("first_row")}else{if(counter==(row_count-1)){row.addClass("last_row")}}}}current_tab.addClass("last_in_row")}if(settings.header){popup_dom.header=$('<div id="menu_popup_header"></div>').appendTo(popup_dom.wrapper);popup_dom.header_title=$("<h2>"+App.clean(settings.header["title"])+"</h2>").appendTo(popup_dom.header);popup_dom.header_actions=$("<ul></ul>").appendTo(popup_dom.header);popup_dom.header_refreshing_indicator=$('<li class="refreshing_indicator"><img src="'+App.Wireframe.Utils.indicatorUrl("normal","",true)+'"/></li>').appendTo(popup_dom.header_actions);if(!pending_refresh){popup_dom.header_refreshing_indicator.hide()}if(settings.header.buttons){$.each(settings.header.buttons,function(name,link){var anchor=$('<a href="'+link.url+'" class="menu_popup_footer_link" title="'+(link.title?link.title:link.text)+'">'+App.clean(link.text)+"</a>").appendTo($("<li></li>").appendTo(popup_dom.header_actions));if(link["class"]){anchor.addClass(link["class"])}if(link.handler){anchor[link.handler]((link.handler_options?link.handler_options:{}))}})}if(settings.header.widgets){$.each(settings.header.widgets,function(name,widget){var widget_container=$("<li "+(name?'id="menu_popup_title_widget_'+name+'"':"")+"></li>").append(widget);popup_dom.header_actions.append(widget_container)})}if(settings.tabs){popup_dom.header.css("top",popup_dom.tabs.outerHeight())}}if(settings.footer){popup_dom.footer=$('<div id="menu_popup_footer"></div>').appendTo(popup_dom.wrapper);$.each(settings.footer,function(name,link){var anchor=$('<a href="'+link.url+'" class="menu_popup_footer_link" title="'+(link.title?link.title:link.text)+'">'+App.clean(link.text)+"</a>").appendTo(popup_dom.footer);if(link["class"]){anchor.addClass(link["class"])}if(link.handler){anchor[link.handler]((link.handler_options?link.handler_options:{}))}})}popup_dom.body_wrapper=$('<div id="menu_popup_body_wrapper"></div>').appendTo(popup_dom.wrapper).css({top:settings.header?parseInt(popup_dom.header.css("top"))+popup_dom.header.outerHeight():0,bottom:settings.footer?popup_dom.footer.outerHeight():10});popup_dom.body=$('<div id="menu_popup_body"></div>').appendTo(popup_dom.body_wrapper);if(settings.body){popup_dom.body.html(settings.body)}popup_dom.scrollbar=$('<div id="menu_popup_scrollbar"></div>').appendTo(popup_dom.wrapper).css({top:settings.header?parseInt(popup_dom.header.css("top"))+popup_dom.header.outerHeight():0,bottom:settings.footer?popup_dom.footer.outerHeight():10}).hide();var scrollbar_color=popup_dom.scrollbar.css("background-color");popup_dom.scrollbar.css("background-color","transparent");popup_dom.scrollbar_handle=$('<div id="menu_popup_scrollbar_handle"></div>').appendTo(popup_dom.scrollbar).draggable({axis:"y",containment:"parent",drag:function(event,ui){var scrollbar_position=ui.position.top;var max_scrollbar_position=popup_dom.scrollbar.height()-popup_dom.scrollbar_handle.height();var max_scroll_top=popup_dom.body.height()-popup_dom.body_wrapper.height()+20;popup_dom.body_wrapper.scrollTop(max_scroll_top*(scrollbar_position/max_scrollbar_position))},start:function(){submenu_methods.close();popup_methods.scrolling=true;popup_dom.scrollbar.css("background-color",scrollbar_color)},stop:function(){popup_methods.scrolling=false;popup_dom.scrollbar.css("background-color","transparent")}});if(settings.handler){App.Wireframe.MainMenu.handlers.execute(settings.handler,[popup_methods.current])}if(popup_dom.body_wrapper.height()<popup_dom.body.height()){popup_dom.scrollbar.show();popup_dom.scrollbar_handle.css("height",Math.round(popup_dom.scrollbar.height()*(popup_dom.body_wrapper.height()/popup_dom.body.height()))+"px")}var quantifier=$.browser.webkit?60:30;popup_dom.wrapper.bind("mousewheel",function(event,delta,delta_x,delta_y){delta_y=Math.ceil(delta_y*quantifier);popup_dom.body_wrapper.scrollTop(popup_dom.body_wrapper.scrollTop()-delta_y);var max_scrollbar_position=popup_dom.scrollbar.height()-popup_dom.scrollbar_handle.height();var max_scroll_top=popup_dom.body.height()-popup_dom.body_wrapper.height()+20;popup_dom.scrollbar_handle.css("top",((popup_dom.body_wrapper.scrollTop()/max_scroll_top)*max_scrollbar_position)+"px")});if(App.isTouchDevice()){popup_dom.body_wrapper.css("overflow-y","scroll");popup_dom.scrollbar.hide()}set_current_popup_item(popup_dom.body.find("a.menu_navigation_item:visible:first"));popup_dom.body.on("click","a.open_submenu_default",function(){submenu_methods.open($(this),true,true);return false});popup_dom.body.on("mouseenter",".menu_navigation_item:not(.open_submenu, .open_submenu_default)",function(){if(!popup_methods.scrolling){var current_item=get_current_popup_item("popup");if(current_item&&current_item.get(0)==this){return true}else{set_current_popup_item($(this),"popup");submenu_methods.close()}}});var horizontal_sensitivity=16;popup_methods.resetXOffsetCounter();popup_dom.body.on("mouseenter",".menu_navigation_item.open_submenu, .menu_navigation_item.open_submenu_default",function(event){if(!popup_methods.scrolling){var nav_item=$(this);if(nav_item.is(".current")){if(!submenu_methods.isOpen()){submenu_methods.open(nav_item,false,false)}return true}if(!previous_x_offset||((event.clientX-previous_x_offset)<horizontal_sensitivity)){submenu_methods.close();submenu_methods.clearTimeout();set_current_popup_item(nav_item,"popup")}previous_x_offset=event.clientX;submenu_methods.open(nav_item,false,false)}});popup_dom.wrapper.on("mouseenter",function(){menu_items[settings.id].addClass("hover");current_context="popup";clearTimeout(main_item_close_timeout);main_item_close_timeout=null;main_item_closing_popup=null});popup_dom.body.on("click","a",function(){var anchor=$(this);if(anchor.is(".open_submenu")&&App.isTouchDevice()){submenu_methods.open($(this),true,true);return false}if(!anchor.is(".do_not_close")){setTimeout(function(){popup_methods.close()},50)}return true});App.Wireframe.Events.unbind(".main_menu_popup");App.Wireframe.Events.bind("keydown.main_menu_popup",function(event){if(event.ctrlKey||event.metaKey||event.shiftKey||event.altKey){return true}var key_code=parseInt(event.which);switch(key_code){case 39:keystrokes().right();return false;break;case 37:keystrokes().left();return false;break;case 38:keystrokes().up();return false;break;case 40:keystrokes().down();return false;break;case 13:keystrokes().enter();return false;break;case 32:keystrokes().space();return false;break;case 27:keystrokes().escape();return false;break;default:if(key_code>=65&&key_code<=122){keystrokes().character(String.fromCharCode(key_code));return false}}});App.Wireframe.Events.bind("click.main_menu_popup",function(event){var item=$(event.target);if(!item.parents("#menu_popup_submenu, #menu_popup").length){popup_methods.close()}});return popup_dom},close:function(){App.Wireframe.Events.unbind(".main_menu_popup");submenu_methods.close();if(popup_methods.current){menu_wrapper.removeClass("popup_open");menu_items[popup_methods.current["settings"]["id"]].removeClass("hover");popup_methods.current.wrapper.remove();popup_methods.current=null}if(focused_item&&focused_item.length&&focused_item.is(":visible")){focused_item.focus()}},resetXOffsetCounter:function(){previous_x_offset=0}}}();var submenu_methods=function(){var current;var open_timeout;var clear_open_timeout=function(){if(open_timeout){clearTimeout(open_timeout);open_timeout=null}};var set_open_timeout=function(callback){clear_open_timeout();open_timeout=setTimeout(callback,150)};return{open:function(parent,instant,change_context){if(submenu_methods.current&&submenu_methods.current["parent"].get(0)==parent.get(0)){clear_open_timeout();return true}if(instant){clear_open_timeout();submenu_methods.close();submenu_methods.render(parent,change_context)}else{clear_open_timeout();set_open_timeout(function(){submenu_methods.close();submenu_methods.render(parent,change_context)})}},render:function(parent,change_context){set_current_popup_item(parent,"popup");var submenu_dom={};submenu_dom.wrapper=$('<div id="menu_popup_submenu"></div>').appendTo(menu_wrapper);submenu_dom.background=$('<div id="menu_popup_submenu_background"></div>').appendTo(submenu_dom.wrapper);submenu_dom.header=$('<div id="menu_popup_submenu_header"></div>').appendTo(submenu_dom.wrapper);submenu_dom.header_title=$("<h3></h3>").appendTo(submenu_dom.header);submenu_dom.footer=$('<div id="menu_popup_submenu_footer"></div>').appendTo(submenu_dom.wrapper);submenu_dom.body=$('<div id="menu_popup_submenu_body"></div>').appendTo(submenu_dom.wrapper);submenu_dom.parent=parent;submenu_methods.current=submenu_dom;App.Wireframe.MainMenu.handlers.execute(parent.attr("submenu_handler"),[parent,popup_methods.current,submenu_methods.current]);var submenu_offset_top=parent.offset().top;if(submenu_offset_top+submenu_dom.wrapper.height()>$(document).height()){submenu_offset_top=$(document).height()-submenu_dom.wrapper.height()}else{submenu_offset_top=submenu_offset_top-20}submenu_dom.wrapper.css("top",submenu_offset_top);if(change_context){set_current_popup_item(submenu_dom.body.find("a.menu_navigation_item:first"),"submenu");current_context="submenu"}submenu_dom.body.on("mouseenter",".menu_navigation_item",function(){set_current_popup_item($(this),"submenu")});submenu_dom.body.on("click","a",function(){popup_methods.close()});submenu_dom.wrapper.on("mouseenter",function(){popup_methods.resetXOffsetCounter();current_context="submenu";clear_open_timeout()})},close:function(){clear_open_timeout();current_context="popup";if(submenu_methods.current){submenu_methods.current.wrapper.remove();submenu_methods.current=null}},clearTimeout:function(){clear_open_timeout()},isOpen:function(){return $("#menu_popup_submenu:visible").length>0}}}();var refresh_methods=function(){var request=null;var timeout=null;var pending=[];var callbacks=[];return{refresh:function(items,callback){if(typeof(items)=="string"){pending.push(items)}else{pending=pending.concat(items)}if(callback&&typeof(callback)=="function"){callbacks.push(callback)}if(!timeout){timeout=setTimeout(function(){var request_url=App.extendUrl(menu_settings.refresh_url,{items:(pending?pending.join(","):null)});var request_callbacks=callbacks.slice(0);pending=[];callbacks=[];$.ajax({url:request_url,success:function(response){if(response){App.each(response,function(menu_id,menu_data){if(menu_data.popup){var previous_popup=popups[menu_id];var updated_popup=menu_data.popup;updated_popup.id=previous_popup.id;if(previous_popup.auto_refresh){updated_popup.refreshed_on=$.now();updated_popup.refreshing=false}updated_popup.loaded=true;popups[menu_id]=updated_popup;if(popup_methods.current&&popup_methods.current["settings"]["id"]==menu_id){popup_methods.render(popups[menu_id],false)}if(request_callbacks&&request_callbacks.length){$.each(request_callbacks,function(index,callback){callback()})}}})}timeout=null}})},300)}}}}();return{init:function(wrapper_id,options){menu_wrapper=$("#"+wrapper_id).append('<ul class="group" id="menu_group_main"></ul><ul class="group" id="menu_group_profile"></ul>');if(!App.isTouchDevice()){menu_wrapper.addClass("show_labels_on_hover")}menu_settings=options;var show_popup_timeout=null;menu_wrapper.on("click","li.main_menu_item.has_popup a",function(){var list_item=$(this).parents("li:first").get(0);if(popup_methods.current&&popup_methods.current["settings"]&&popup_methods.current["settings"]["id"]&&popup_methods.current["settings"]["id"]==list_item.item_id){popup_methods.close()}else{popup_methods.open(popups[list_item.item_id],false)}return false});menu_wrapper.on("click","li.main_menu_item:not(.has_popup) a",function(){popup_methods.close()});menu_wrapper.on("mouseleave","li.main_menu_item",function(){if(popup_methods.current&&popup_methods.current["settings"]&&popup_methods.current["settings"]["id"]&&popup_methods.current["settings"]["id"]==this.item_id){main_item_close_timeout=setTimeout(function(){popup_methods.close();main_item_closing_popup=null;main_item_close_timeout=null},300);main_item_closing_popup=this.item_id}});menu_wrapper.on("mouseenter","li.main_menu_item",function(){if(popup_methods.current&&popup_methods.current["settings"]&&main_item_closing_popup==this.item_id&&main_item_close_timeout){clearTimeout(main_item_close_timeout);main_item_close_timeout=null;main_item_closing_popup=null}else{if(!main_item_close_timeout){popup_methods.close();main_item_closing_popup=null}}})},add:function(item_name,item,is_current){var item=jQuery.extend({title:null,url:"",icon:null,onclick:null,group:"main",add_before:null},item);var group=menu_wrapper.find("#menu_group_"+item.group);if(group.length&&item.title){var title=App.clean(item.title);var list_item=$('<li id="menu_item_'+item_name+'" class="main_menu_item"><a href="'+App.clean(item.url)+'"><span class="icon"><img src="'+App.clean(item.icon)+'" /><span class="badge">'+(item.badge?item.badge:"")+'</span></span><span class="label">'+title+"</span></a></li>");if(!item.badge){list_item.find("span.badge").hide()}list_item.get(0).item_id=item_name;list_item.get(0).list_item=list_item;menu_items[item_name]=list_item;if(item.add_before!=null){var before_item=menu_wrapper.find("#menu_item_"+item.add_before);before_item.before(list_item)}else{group.append(list_item)}if(is_current){group.find("li.main_menu_item").removeClass("current");list_item.addClass("current")}if(typeof(item.onclick)=="string"&&item.onclick){var onclick;eval("onclick = "+item.onclick);if(typeof(onclick)=="function"){onclick.apply(list_item[0])}}if(item.popup){item.popup["id"]=item_name;popups[item_name]=item.popup;list_item.addClass("has_popup")}}},remove:function(item_name){var item=menu_wrapper.find("#menu_item_"+item_name).remove();if(menu_items[item_name]){delete menu_items[item_name]}if(popups[item_name]){delete popups[item_name]}},getCurrent:function(){var current_item=menu_wrapper.find("li.main_menu_item.current");if(current_item.length){return current_item.attr("id").substr(10)}else{return false}},setCurrent:function(name){$("body").attr("current_section",name).attr("current_tab","");var item=menu_wrapper.find("#menu_item_"+name);if(item.length>0){menu_wrapper.find("li.main_menu_item").removeClass("current");item.addClass("current")}},setItemBadge:function(name,badge_value){var item=menu_wrapper.find("#menu_item_"+name);var badge=item.find("span.badge");if(badge_value){badge.text(badge_value).show()}else{badge.text("").hide()}},batchSet:function(items,current_item){App.Wireframe.MainMenu.clear();for(var item_name in items){App.Wireframe.MainMenu.add(item_name,items[item_name],(current_item==item_name))}App.Wireframe.MainMenu.initializePopups()},clear:function(){App.Wireframe.Events.unbind(".main_menu");menu_wrapper.find("ul.group").empty()},handlers:{register:function(name,popup_id,handler,init){if(init&&typeof(init)=="function"){handler_inits[name]={"function":init,popup_id:popup_id}}handlers[name]=handler},execute:function(name,params){handlers[name].apply(this,params)}},getPopup:function(popup_id){return popups[popup_id]},closePopup:function(){popup_methods.close()},isSubmenuOpen:function(){return submenu_methods.isOpen()},closeSubmenu:function(){submenu_methods.close()},initializePopups:function(){var to_refresh=[];if(handler_inits){$.each(handler_inits,function(index,handler_init){var popup=popups[handler_init.popup_id];handler_init["function"](popup,index)})}$.each(popups,function(id,popup){if(popup.initial_refresh){to_refresh.push(popup.id)}});setTimeout(function(){refresh_methods.refresh(to_refresh)},1000)},refresh:function(items){refresh_methods.refresh(items)}}}();
App.Wireframe.MainMenu.handlers.register("admin","admin",function(popup_dom){popup_dom.wrapper.addClass("control_tower control_tower_menu_popup");popup_dom.admin_link=$('<div class="menu_navigation_group control_tower_additional menu_navigation_row grouped_popup_buttons"></div>').appendTo(popup_dom.body);popup_dom.admin_link.append('<a title="'+App.lang("Administration")+'" class="menu_navigation_item grouped_popup_button" href="'+popup_dom.settings["additional"]["administration_url"]+'"><img src="'+App.Wireframe.Utils.imageUrl("icons/12x12/settings-white.png","environment")+'">'+App.lang("Administration")+"</a>");var control_tower_loaded=popup_dom.settings["loaded"];if(!control_tower_loaded){popup_dom.body.append('<p class="empty_page">'+App.lang("Loading Control Tower")+"...</p>")}else{popup_dom.body.append(popup_dom.settings["additional"]["control_tower"])}var progress_indicator=App.Wireframe.Utils.indicatorUrl("normal","",false);popup_dom.body.find("ul.control_tower_quick_actions:first").on("click","a",function(){var anchor=$(this);var icon=anchor.find("img:first");var original_icon=icon.attr("src");icon.attr("src",progress_indicator);$.ajax({url:anchor.attr("href"),type:"post",data:{submitted:"submitted"},complete:function(response){icon.attr("src",original_icon)}});return false})});
(function(){App.widgets.diskSpaceAdminPopup=function(){var wrapper_id=null;var wrapper=null;var label=null;var progressbar_outer=null;var progressbar_inner=null;var total_usage=null;var available_usage=null;var refresh_url=null;var percents=null;var update_progressbar=function(){wrapper=$("#"+wrapper_id);label=wrapper.find(".advanced_progressbar_label");progressbar_outer=wrapper.find(".advanced_progressbar_progressbar").hide();progressbar_inner=progressbar_outer.find(".advanced_progressbar_progressbar_inner");if(progressbar_outer.length){progressbar_outer.show();percents=Math.round(total_usage*100/available_usage);percents=percents<0?0:percents>100?100:percents;progressbar_inner.css("width",percents+"%")}var formatted_available_usage=App.formatFileSize(available_usage);var formatted_total_usage=App.formatFileSize(total_usage);if(available_usage){label.html(App.lang("<span>:used</span> of <span>:available</span> used",{available:formatted_available_usage,used:formatted_total_usage}))}else{label.html(App.lang("<span>:used</span> used",{used:formatted_total_usage}))}};return{init:function(init_wrapper_id,init_available_usage,init_refresh_url){wrapper_id=init_wrapper_id;wrapper=$("#"+wrapper_id);refresh_url=init_refresh_url;available_usage=init_available_usage;if(total_usage===null){label=wrapper.find(".advanced_progressbar_label");progressbar_outer=wrapper.find(".advanced_progressbar_progressbar").hide();progressbar_inner=progressbar_outer.find(".advanced_progressbar_progressbar_inner");if(progressbar_outer.length){label.html('<div style="margin-top: 7px">'+App.lang("Calculating")+" ...</div>")}else{label.html("<div>"+App.lang("Calculating")+" ...</div>")}$.ajax({url:App.extendUrl(refresh_url,{async:1}),success:function(response){total_usage=parseInt(response);update_progressbar()}});return true}else{setTimeout(function(){update_progressbar()},5)}}}}()}());
App.widgets.FlyoutDialog=function(){var can_close_dialog=function(instance){var instance_data=instance.data("flyout_data");var dialog_form=instance_data.content.find("form:first");if(!dialog_form.length){return true}var form_has_changed=false;if(instance_data.initial_form_state){var elements=dialog_form.find('textarea, input[type="text"]').each(function(){var element=$(this);if(instance_data.initial_form_state[element.attr("name")]!=element.val()){form_has_changed=true;return false}})}return !form_has_changed};var do_close_dialog=function(instance){var instance_data=instance.data("flyout_data");var flyout_id=instance_data.id;if(instance_data&&$.isFunction(instance_data.settings.close)){instance_data.settings.close.apply(instance_data.content.children(":first")[0])}$(window).unbind("resize."+flyout_id);App.Wireframe.Events.unbind(".flyout");App.Wireframe.Events.unbind("."+flyout_id);instance.remove();if(!App.widgets.FlyoutDialog.countOpened()){App.Wireframe.handleEscape.remove(flyout_id)}if(instance_data.item_with_focus&&instance_data.item_with_focus.length&&instance_data.item_with_focus.parents("body").length){instance_data.item_with_focus.focus()}else{$("body").focus()}if($.isFunction(instance_data.settings.on_close)){instance_data.settings.on_close()}};var save_initial_form_state=function(instance){setTimeout(function(){var instance_data=instance.data("flyout_data");instance_data.initial_form_state={};var dialog_form=instance_data.content.find("form:first");if(!dialog_form.length){return true}var elements=dialog_form.find('textarea, input[type="text"]');elements.each(function(){var element=$(this);instance_data.initial_form_state[element.attr("name")]=element.val()})},50)};var start_handling_escape_key=function(instance){};var defaults={name:"flyout_dialog_"+(new Date().getTime()),data:"",data_type:"string",data_request:"get",title:App.lang("Dialog"),width:980,width_class:null,max_height:"90%",height:"90%",on_close:null,success:null,error:null,auto_size:true,block_mode:false};return{show:function(options){var flyout_id="flyout_dialog_"+$.now()+"_"+Math.floor((Math.random()*100)+1);var instance=$('<div class="flyout_dialog"></div>').appendTo("body").attr("id",flyout_id);var overflow=$('<div class="flyout_dialog_page_overflow"></div>').appendTo(instance);var wrapper=$('<div class="flyout_dialog_wrapper"></div>').appendTo(instance);var title_wrapper=$('<div class="flyout_dialog_title_wrapper"></div>').appendTo(wrapper);var title=$('<h2 class="flyout_dialog_title"></h2>').appendTo(title_wrapper);var buttons=$('<span class="flyout_dialog_buttons"></span>').appendTo(title_wrapper).hide();var close_button=$('<a href="#" class="flyout_dialog_close_button">x</a>').appendTo(title_wrapper);var content=$('<div class="flyout_dialog_content"></div>').appendTo(wrapper);var item_with_focus=$(":focus").blur();overflow.css("z-index",App.getZIndex());wrapper.css("z-index",App.getZIndex());var settings=$.extend({},defaults,options);settings.name=settings.name?settings.name:"flyout_dialog_"+(new Date().getTime());instance.data("flyout_data",{id:flyout_id,instance:instance,overflow:overflow,wrapper:wrapper,title_wrapper:title_wrapper,title:title,buttons:buttons,close_button:close_button,content:content,settings:settings,item_with_focus:item_with_focus});App.widgets.FlyoutDialog.setTitle(instance,settings.title);if(settings.width_class){wrapper.addClass("width_"+settings.width_class);App.widgets.FlyoutDialog.setWidth(instance,wrapper.width())}else{App.widgets.FlyoutDialog.setWidth(instance,settings.width)}App.widgets.FlyoutDialog.setAutoSize(instance,options.height?false:true);if(settings["class"]){wrapper.addClass(settings["class"])}close_button.click(function(){App.widgets.FlyoutDialog.close(instance);return false});if(App.widgets.FlyoutDialog.countOpened()==1){App.Wireframe.handleEscape.add(flyout_id,function(){App.widgets.FlyoutDialog.front().close(true);return false})}App.widgets.FlyoutDialog.loadContent(instance);if(settings.block_mode){App.widgets.FlyoutDialog.enableBlockMode()}return instance},loadContent:function(instance){var instance_data=instance.data("flyout_data");instance_data.content.addClass("loading");var data_type=instance_data.settings.data_type.toLowerCase();if(data_type=="url"){$.ajax({url:instance_data.settings.data,decorate_url:{async:1,flyout:instance_data.id},type:instance_data.settings["data_request"],data:instance_data.settings["data_additional"],success:function(response){instance_data.content.empty().append(response);App.widgets.FlyoutDialog.setAutoSize(instance,App.widgets.FlyoutDialog.getAutoSize(instance));instance_data.content.removeClass("loading");App.widgets.FlyoutDialog.drawButtons(instance);if($.isFunction(instance_data.settings.success)){instance_data.settings.success.apply(instance_data.content.children(":not(script):first")[0])}save_initial_form_state(instance)}})}else{instance_data.content.removeClass("loading").html(instance_data.settings.data);App.widgets.FlyoutDialog.setAutoSize(instance,App.widgets.FlyoutDialog.getAutoSize(instance));App.widgets.FlyoutDialog.drawButtons(instance);if($.isFunction(instance_data.settings.success)){instance_data.settings.success.apply(instance_data.content.children(":not(script):first")[0])}save_initial_form_state(instance)}},hasButtons:function(instance){var buttons=instance.data("flyout_data").settings.buttons;return(buttons&&(typeof(buttons)=="object"&&(buttons instanceof Array))&&buttons.length)},drawButtons:function(instance){if(!App.widgets.FlyoutDialog.hasButtons(instance)){return false}var instance_data=instance.data("flyout_data");if(!instance_data.buttons_wrapper){instance_data.buttons_wrapper=$('<div class="button_holder"></div>').appendTo(instance_data.wrapper)}var buttons=instance_data.settings.buttons;for(var x in buttons){var dialog_button=$('<button type="submit" class="'+(x==0?"default":"alternative")+'">'+buttons[x].title+"</button>").appendTo(instance_data.buttons_wrapper);if(buttons[x].callback&&(typeof(buttons[x].callback)=="function")){dialog_button.data("callback",buttons[x].callback).click(function(){if($(this).data("callback")()){App.widgets.FlyoutDialog.close(instance)}})}}},setWidth:function(instance,width){instance.data("flyout_data").wrapper.css("width",width).css("margin-left",parseInt(width/2)*-1)},setTitle:function(instance,title){instance.data("flyout_data").title.html(title)},addButton:function(instance,name,button){var button_instance=$('<a href="'+button.url+'" class="flyout_dialog_button" id="flyout_dialog_button_'+name+'" title="'+App.clean(button.text)+'">'+App.clean(button.text)+"</a>").disableSelection().appendTo(instance.data("flyout_data").buttons);if(button.icon){button_instance.css({"background-image":"url("+button.icon+")","padding-left":"29px"})}if(typeof(button.attributes)=="object"&&button.attributes){button_instance.attr(button.attributes)}if(typeof(button.onclick)=="string"&&button.onclick){var onclick;eval("onclick = "+button.onclick);if(typeof(onclick)=="function"){onclick.apply(button_instance[0])}}else{if(typeof(button.onclick)=="function"){button_instance.click(function(){return button.onclick.apply(button_instance[0])})}else{button_instance.openInline()}}instance.data("flyout_data").buttons.show()},getAutoSize:function(instance){return instance.data("flyout_data").settings.auto_size},setAutoSize:function(instance,mode){instance.data("flyout_data").settings.auto_size=mode;App.widgets.FlyoutDialog.handleResize(instance)},handleResize:function(instance){var instance_data=instance.data("flyout_data");if(App.widgets.FlyoutDialog.getAutoSize(instance)){var constrained_height=instance_data.settings.max_height;var css_property="max-height"}else{var constrained_height=instance_data.settings.height;var css_property="height"}instance_data.wrapper.find(".autoscrolled").removeAttr("style").removeClass("autoscrolled");var flyout_id=instance_data.id;$(window).unbind("resize."+flyout_id).bind("resize."+flyout_id,function(){var document_height=instance_data.overflow.height();if(constrained_height.indexOf("%")!=-1){var base_calculated_height=Math.round(parseInt(constrained_height)*document_height/100)}else{var base_calculated_height=parseInt(constrained_height)}var scroll_wrapper=null;var constrained_height_calculated=null;constrained_height_calculated=base_calculated_height-instance_data.title_wrapper.outerHeight();if((scroll_wrapper=instance_data.content.find("form .content_stack_wrapper:first")).length){if((instance_data.buttons_wrapper=instance_data.content.find("form .button_holder:first")).length){constrained_height_calculated=constrained_height_calculated-instance_data.buttons_wrapper.outerHeight()}}else{if((scroll_wrapper=instance_data.content.find("form .fields_wrapper:first")).length){if((instance_data.buttons_wrapper=instance_data.content.find("form .button_holder:first")).length){constrained_height_calculated=constrained_height_calculated-instance_data.buttons_wrapper.outerHeight()}}else{if((scroll_wrapper=instance_data.content.find(".scrollable")).length){if((instance_data.buttons_wrapper=instance_data.content.find(".button_holder:first")).length){constrained_height_calculated=constrained_height_calculated-instance_data.buttons_wrapper.outerHeight();instance_data.buttons_wrapper.css("padding-top","10px");instance_data.buttons_wrapper.css("padding-bottom","5px")}}else{scroll_wrapper=instance_data.content}}}if(constrained_height_calculated!==null){scroll_wrapper.css(css_property,constrained_height_calculated).css("overflow-y","auto").addClass("autoscrolled")}}).resize()},startProcessing:function(instance){var instance_data=instance.data("flyout_data");instance_data.processing_curtain=$('<div class="flyout_dialog_processing_curtain"></div>').insertAfter(instance_data.content.hide())},stopProcessing:function(instance){var instance_data=instance.data("flyout_data");if(instance_data&&instance_data.processing_curtain&&instance_data.processing_curtain.length){instance_data.processing_curtain.remove();instance_data.processing_curtain=null;instance_data.content.show()}},close:function(instance,interactive){if(!instance.length||!instance.is(":visible")){return false}if(instance.data("flyout_data")["block_mode_enabled"]){return false}if(!interactive||can_close_dialog(instance)){do_close_dialog(instance)}else{if(confirm(App.lang("Close dialog without saving changes?"))){do_close_dialog(instance)}}},countOpened:function(){return $("body").find("div.flyout_dialog").length},enableBlockMode:function(instance){var close_button=instance.find(".flyout_dialog_close_button");if(close_button.length){close_button.hide()}instance.data("flyout_data")["block_mode_enabled"]=true},disableBlockMode:function(instance){var close_button=instance.find(".flyout_dialog_close_button");if(close_button.length){close_button.show()}instance.data("flyout_data")["block_mode_enabled"]=false},front:function(){var front_instance=$("body").find("div.flyout_dialog:last");return{instance:function(){return front_instance},close:function(interactive){if(!front_instance.length){return false}return App.widgets.FlyoutDialog.close(front_instance,interactive)},setAutoSize:function(mode){if(!front_instance.length){return false}return App.widgets.FlyoutDialog.setAutoSize(front_instance,mode)},setTitle:function(title){if(!front_instance.length){return false}return App.widgets.FlyoutDialog.setTitle(front_instance,title)},addButton:function(name,button){return App.widgets.FlyoutDialog.addButton(front_instance,name,button)},startProcessing:function(){return App.widgets.FlyoutDialog.startProcessing(front_instance)},stopProcessing:function(){return App.widgets.FlyoutDialog.stopProcessing(front_instance)}}}}}();
App.widgets.QuickView=function(){var initialized=false;var wrapper=false;var stage=false;var overlay=false;var cards=false;var navigator=false;var navigator_dots=false;var current_card=false;var initialize=function(){initialized=true;wrapper=$("body");App.Wireframe.Events.bind("history_state_changed",function(event){if(stage){$.each(stage.find(".quick_view_card"),function(){close_card($(this))});close_preview_stage()}})};var open_preview_stage=function(){if(!stage){stage=$('<div class="quick_view_wrapper"></div>').appendTo(wrapper);overlay=$('<div class="quick_view_overlay"></div>').appendTo(stage);cards=$('<div class="quick_view_cards"></div>').appendTo(stage);navigator=$('<div class="quick_view_navigator"></div>').appendTo(stage).disableSelection();navigator_dots=$("<ul></ul>").appendTo(navigator);App.Wireframe.handleEscape.add("quick_view",function(){if(current_card&&current_card.length){close_card(current_card);return false}});App.Wireframe.Events.bind("window_resize.quick_view",function(){update_title_dimensions(current_card)})}stage.css("z-index",App.getZIndex())};var close_preview_stage=function(){if(stage){stage.remove();stage=false;App.Wireframe.Events.unbind(".quick_view");App.Wireframe.handleEscape.remove("quick_view")}};var has_cards=function(){return stage.find("div.quick_view_card").length};var preview=function(url,preview_title){if(!initialized){initialize()}open_preview_stage();var existing_card=cards.find('div.quick_view_card[url="'+url+'"]');if(existing_card.length){reload(existing_card);return true}var card_id="card_"+$.now()+Math.floor((Math.random()*1000000)+1);var card=$('<div class="quick_view_card" id="'+card_id+'" url="'+url+'"></div>');var card_navigator_dot=$("<li>"+App.clean(App.excerpt(preview_title,35))+"</li>").data("card",card).click(function(){set_current_card(card)});if(current_card&&current_card.length){card.insertAfter(current_card);card_navigator_dot.insertAfter(current_card.data("quick_view")["navigator_dot"]);current_card.hide()}else{card.appendTo(cards);card_navigator_dot.appendTo(navigator_dots)}var title_wrapper=$('<div class="quick_view_card_title_wrapper"></div>').appendTo(card);var title=$("<h1></h1>").appendTo(title_wrapper).text(preview_title);var actions=$('<ul class="quick_view_card_options"></ul>').appendTo(title_wrapper);var close_button=$('<a href="#" class="quick_view_card_close_button"></a>').appendTo($("<li></li>").appendTo(actions)).click(function(){close_card(card);return false});var print_button=$('<a href="#" class="quick_view_card_action_button quick_view_card_print_preview_button"></a>').appendTo($("<li></li>").prependTo(actions).hide()).click(function(){App.Wireframe.Print.doPrint($(this).attr("href"));return false});var content=$('<div class="quick_view_card_content"></div>').appendTo(card);card.data("quick_view",{title_wrapper:title_wrapper,title:title,actions:actions,close_button:close_button,print_button:print_button,content:content,navigator_dot:card_navigator_dot});load_content(url,card);set_current_card(card)};var reload=function(card){set_current_card(card);var content=card.find("div.quick_view_card_content").css("background-image","url("+App.Wireframe.Utils.indicatorUrl("big")+")");card.find(".quick_view_card_action_drop_down.quick_view_card_action_object_options").remove();load_content(card.attr("url"),card)};var load_content=function(url,card){card.data("quick_view").content.empty().css("background-image","url("+App.Wireframe.Utils.indicatorUrl("big")+")");$.ajax({url:url,decorate_url:{quick_view:card.attr("id")},success:function(response){card.data("quick_view").content.css("background-image","none");card.data("quick_view").content.append(response);App.Wireframe.Events.trigger("quick_view_content_loaded",[card[0],url])}})};var set_current_card=function(card){if(current_card&&current_card.length){current_card.hide();current_card.data("quick_view")["navigator_dot"].removeClass("current")}current_card=card;current_card.show();current_card.data("quick_view")["navigator_dot"].addClass("current")};var close_card=function(card){var previous_card=card.prev();var next_card=card.next();App.Wireframe.Events.unbind("."+card.attr("id"));card.data("quick_view")["navigator_dot"].remove();card.remove();if(current_card&&current_card.get(0)==card.get(0)){current_card=false}if(previous_card&&previous_card.length){set_current_card(previous_card)}else{if(next_card&&next_card.length){set_current_card(next_card)}}if(!has_cards()){close_preview_stage()}};var get_card=function(card_id){var card=stage.find('div.quick_view_card[id="'+card_id+'"]');return card.length?card:false};var set_card_title=function(card,title){card.data("quick_view")["title"].text(title);card.data("quick_view")["navigator_dot"].attr("title",App.clean(title)).text(App.excerpt(title,35));update_title_dimensions(card)};var batch_set_actions=function(card,actions){if(!actions.object_options){return false}$.each(actions,function(action_name,action_details){if(action_name=="object_options"){if(typeof(actions[action_name]["subitems"])=="object"&&actions[action_name]["subitems"]!==null){add_dropdown(card,action_name,actions[action_name]["text"],actions[action_name]["subitems"])}}});update_title_dimensions(card)};var add_dropdown=function(card,name,title,subitems){var actions_wrapper=card.data("quick_view")["actions"];var dropdown=$('<li class="quick_view_card_action_drop_down quick_view_card_action_'+name+'"><span class="quick_view_card_action_button">'+App.clean(title)+'</span><div class="quick_view_card_action_drop_down_menu"><ul class="object_options"></ul></div></li>').prependTo(actions_wrapper).disableSelection();var dropdown_menu=dropdown.find(".quick_view_card_action_drop_down_menu").hide();dropdown.delayedHover(function(){dropdown.addClass("hover");dropdown_menu.show()},function(){dropdown.removeClass("hover");dropdown_menu.hide()},100);render_dropdown_subitems(card,subitems,dropdown.find("ul:first"));dropdown.find("div.drop_down *").click(function(){dropdown.removeClass("hover");dropdown_menu.hide()})};var render_dropdown_subitems=function(card,subitems,options_list){for(var i in subitems){if(subitems[i]["text"]&&subitems[i]["url"]){var item=$('<li class="subaction"><a href="'+App.clean(subitems[i].url)+'" title="'+App.clean(subitems[i]["text"])+'">'+App.clean(subitems[i]["text"])+"</a></li>").appendTo(options_list);var link=item.find("a");if(subitems[i]["class"]){link.addClass(subitems[i]["class"])}if(subitems[i]["icon"]){link.css({"background-image":"url("+subitems[i]["icon"]+")"})}for(var j in subitems[i]){if(j=="url"||j=="text"||j=="class"||j=="onclick"){continue}link.attr(j,subitems[i][j])}if(typeof(subitems[i]["attributes"])=="object"&&subitems[i]["attributes"]){link.attr(subitems[i]["attributes"])}if(typeof(subitems[i]["onclick"])=="string"&&subitems[i]["onclick"]){var onclick;eval("onclick = "+subitems[i]["onclick"]);if(typeof(onclick)=="function"){onclick.apply(link[0])}}else{if(typeof(subitems[i]["onclick"])=="function"){link.click(function(){return subitems[i]["onclick"].apply(link[0])})}else{link.openInline()}}}else{$('<li class="separator"></li>').appendTo(options_list)}}};var update_dropdown=function(card,dropdown_id,options){var dropdown=card.data("quick_view")["actions"].find("."+dropdown_id);var options_list=dropdown.find("ul").empty();render_dropdown_subitems(card,options,options_list);update_title_dimensions(card)};var add_titlebar_widget=function(card,after,widget_id,widget){var full_id="page_title_widget_"+widget_id;var title=card.data("quick_view")["title"];title.find("span."+full_id).remove();var widgets_wrapper;if(after){widgets_wrapper=title.find("span.page_title_right_widgets")}else{widgets_wrapper=title.find("span.page_title_left_widgets")}if(!widgets_wrapper.length){if(after){widgets_wrapper=$('<span class="page_title_right_widgets"></span>').appendTo(title)}else{widgets_wrapper=$('<span class="page_title_left_widgets"></span>').prependTo(title)}}var widget_wrapper=$('<span class="'+full_id+' widget"></span>').append(widget).prependTo(widgets_wrapper);if(after){widget_wrapper.addClass("right_title_widget")}else{widget_wrapper.addClass("left_title_widget")}};var update_title_dimensions=function(card){var title=card.data("quick_view")["title"];var title_wrapper=card.data("quick_view")["title_wrapper"];var actions=card.data("quick_view")["actions"];title.css("width",(title_wrapper.width()-actions.width()-40)+"px")};var set_print_url=function(card,url){var print_button=card.data("quick_view")["print_button"];print_button.attr("href",url?url:"#");url?print_button.parent().show():print_button.parent().hide();update_title_dimensions(card)};return{preview:function(item,forced){var title="";var url="";if(!(item.is(".quick_view_item")||item.parents(".quick_view_item").length||item.is(".quick_view_preview_indicator"))){return false}if(!(forced||(item.is(".force_quick_view")||item.parents(".force_quick_view").length)||item.is(".quick_view_preview_indicator"))){return false}var preview_item=item;if(item.is(".quick_view_preview_indicator")){preview_item=item.parent()}if(preview_item.is("a")){if(preview_item.attr("quick_view_title")){title=preview_item.attr("quick_view_title")}else{if(preview_item.attr("title")){title=preview_item.attr("title")}else{title=preview_item.text()}}url=preview_item.attr("quick_view_url")?preview_item.attr("quick_view_url"):preview_item.attr("href")}else{return false}preview(url,title);return true},open:function(url,title){preview(url,title);return true},setTitle:function(card_id,title){card=get_card(card_id);set_card_title(card,title)},batchSetActions:function(card_id,actions){card=get_card(card_id);batch_set_actions(card,actions)},updateDropDown:function(card_id,dropdown_name,options){card=get_card(card_id);update_dropdown(card,dropdown_name,options)},addTitlebarWidget:function(card_id,after,widget_id,widget){card=get_card(card_id);add_titlebar_widget(card,after,widget_id,widget)},setPrintUrl:function(card_id,print_url){card=get_card(card_id);set_print_url(card,print_url)}}}();
App.Wireframe.Utils.Caret=function(){function doGetCaretPosition(ctrl){var CaretPos=0;if(document.selection){ctrl.focus();var Sel=document.selection.createRange();Sel.moveStart("character",-ctrl.value.length);CaretPos=Sel.text.length}else{if(ctrl.selectionStart||ctrl.selectionStart=="0"){CaretPos=ctrl.selectionStart}}return(CaretPos)}function setCaretPosition(ctrl,pos){if(ctrl.setSelectionRange){ctrl.focus();ctrl.setSelectionRange(pos,pos)}else{if(ctrl.createTextRange){var range=ctrl.createTextRange();range.collapse(true);range.moveEnd("character",pos);range.moveStart("character",pos);range.select()}}}return{getPosition:function(control){return doGetCaretPosition(control[0])},setPosition:function(control,position){return setCaretPosition(control[0],position)},isOnEnd:function(control){return doGetCaretPosition(control[0])==control.val().length},isOnBeginning:function(control){return doGetCaretPosition(control[0])==0}}}();
